(()=>{let e,t;var r,n=globalThis;let i=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},s=function(e){let t=[],r=0,n=0;for(;r<e.length;){let i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=e[r++],a=((7&i)<<18|(63&s)<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(a>>10)),t[n++]=String.fromCharCode(56320+(1023&a))}else{let s=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,c=i>>2,u=(3&i)<<4|a>>4,h=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(h=64)),n.push(r[c],r[u],r[h],r[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(i(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):s(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let i=r[e.charAt(t++)],s=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,l=++t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==l)throw new o;let c=i<<2|s>>4;if(n.push(c),64!==a){let e=s<<4&240|a>>2;if(n.push(e),64!==l){let e=a<<6&192|l;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class o extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let l=function(e){let t=i(e);return a.encodeByteArray(t,!0)},c=function(e){return l(e).replace(/\./g,"")},u=function(e){try{return a.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},h=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n)return n;throw Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&u(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},d=()=>{var e;return null==(e=h())?void 0:e.config},p=e=>{var t;return null==(t=h())?void 0:t[`_${e}`]};class f{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function m(e){return e.endsWith(".cloudworkstations.dev")}async function g(e){return(await fetch(e,{credentials:"include"})).ok}let v={},I=!1;function _(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}class y extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,y.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,E.prototype.create)}}class E{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var r,n;let i=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(r=a,n=i,r.replace(w,(e,t)=>{let r=n[t];return null!=r?String(r):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new y(s,l,i)}}let w=/\{\$([^}]+)}/g;function b(e,t){if(e===t)return!0;let r=Object.keys(e),n=Object.keys(t);for(let i of r){if(!n.includes(i))return!1;let r=e[i],s=t[i];if(T(r)&&T(s)){if(!b(r,s))return!1}else if(r!==s)return!1}for(let e of n)if(!r.includes(e))return!1;return!0}function T(e){return null!==e&&"object"==typeof e}function k(e){let t=[];for(let[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function S(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[r,n]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(n)}}),t}function C(e){let t=e.indexOf("?");if(!t)return"";let r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}class A{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw Error("Missing Observer.");void 0===(n=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:r}:e).next&&(n.next=P),void 0===n.error&&(n.error=P),void 0===n.complete&&(n.complete=P);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function P(){}function R(e){return e&&e._delegate?e._delegate:e}class O{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let N="[DEFAULT]";class L{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new f;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!=(t=null==e?void 0:e.optional)&&t;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(e){if(n)return null;throw e}if(n)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:N})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=N){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=N){return this.instances.has(e)}getOptions(e=N){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){var r;let n=this.normalizeInstanceIdentifier(t),i=null!=(r=this.onInitCallbacks.get(n))?r:new Set;i.add(e),this.onInitCallbacks.set(n,i);let s=this.instances.get(n);return s&&e(s,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let n of r)try{n(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var r;let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===N?void 0:r,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}return n||null}normalizeInstanceIdentifier(e=N){return this.component?this.component.multipleInstances?e:N:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class D{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new L(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let M=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(r||(r={}));let U={debug:r.DEBUG,verbose:r.VERBOSE,info:r.INFO,warn:r.WARN,error:r.ERROR,silent:r.SILENT},F=r.INFO,j={[r.DEBUG]:"log",[r.VERBOSE]:"log",[r.INFO]:"info",[r.WARN]:"warn",[r.ERROR]:"error"},x=(e,t,...r)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),i=j[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class H{constructor(e){this.name=e,this._logLevel=F,this._logHandler=x,this._userLogHandler=null,M.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in r))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?U[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,r.DEBUG,...e),this._logHandler(this,r.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,r.VERBOSE,...e),this._logHandler(this,r.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,r.INFO,...e),this._logHandler(this,r.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,r.WARN,...e),this._logHandler(this,r.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,r.ERROR,...e),this._logHandler(this,r.ERROR,...e)}}let V=new WeakMap,B=new WeakMap,W=new WeakMap,$=new WeakMap,z=new WeakMap,G={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return B.get(e);if("objectStoreNames"===t)return e.objectStoreNames||W.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return q(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function q(r){if(r instanceof IDBRequest){let e=new Promise((e,t)=>{let n=()=>{r.removeEventListener("success",i),r.removeEventListener("error",s)},i=()=>{e(q(r.result)),n()},s=()=>{t(r.error),n()};r.addEventListener("success",i),r.addEventListener("error",s)});return e.then(e=>{e instanceof IDBCursor&&V.set(e,r)}).catch(()=>{}),z.set(e,r),e}if($.has(r))return $.get(r);let n=function(r){if("function"==typeof r)return r!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(t||(t=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(r)?function(...e){return r.apply(K(this),e),q(V.get(this))}:function(...e){return q(r.apply(K(this),e))}:function(e,...t){let n=r.call(K(this),e,...t);return W.set(n,e.sort?e.sort():[e]),q(n)};return r instanceof IDBTransaction&&function(e){if(B.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});B.set(e,t)}(r),(e||(e=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>r instanceof e)?new Proxy(r,G):r}(r);return n!==r&&($.set(r,n),z.set(n,r)),n}let K=e=>z.get(e),J=["get","getKey","getAll","getAllKeys","count"],Y=["put","add","delete","clear"],X=new Map;function Z(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(X.get(t))return X.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=Y.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||J.includes(r)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&s.done]))[0]};return X.set(t,s),s}G=(e=>({...e,get:(t,r,n)=>Z(t,r)||e.get(t,r,n),has:(t,r)=>!!Z(t,r)||e.has(t,r)}))(G);class Q{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!function(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let ee="@firebase/app",et="0.13.1",er=new H("@firebase/app"),en="[DEFAULT]",ei={[ee]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},es=new Map,ea=new Map,eo=new Map;function el(e,t){try{e.container.addComponent(t)}catch(r){er.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function ec(e){let t=e.name;if(eo.has(t))return er.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(eo.set(t,e),es.values()))el(r,e);for(let t of ea.values())el(t,e);return!0}function eu(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function eh(e){return null!=e&&void 0!==e.settings}let ed=new E("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class ep{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new O("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ed.create("app-deleted",{appName:this._name})}}let ef="11.9.0";function em(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let n=Object.assign({name:en,automaticDataCollectionEnabled:!0},t),i=n.name;if("string"!=typeof i||!i)throw ed.create("bad-app-name",{appName:String(i)});if(r||(r=d()),!r)throw ed.create("no-options");let s=es.get(i);if(s)if(b(r,s.options)&&b(n,s.config))return s;else throw ed.create("duplicate-app",{appName:i});let a=new D(i);for(let e of eo.values())a.addComponent(e);let o=new ep(r,n,a);return es.set(i,o),o}function eg(e,t,r){var n;let i=null!=(n=ei[e])?n:e;r&&(i+=`-${r}`);let s=i.match(/\s|\//),a=t.match(/\s|\//);if(s||a){let e=[`Unable to register library "${i}" with version "${t}":`];s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),er.warn(e.join(" "));return}ec(new O(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}let ev="firebase-heartbeat-store",eI=null;function e_(){return eI||(eI=(function(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(e,1),o=q(a);return n&&a.addEventListener("upgradeneeded",e=>{n(q(a.result),e.oldVersion,e.newVersion,q(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ev)}catch(e){console.warn(e)}}}).catch(e=>{throw ed.create("idb-open",{originalErrorMessage:e.message})})),eI}async function ey(e){try{let t=(await e_()).transaction(ev),r=await t.objectStore(ev).get(ew(e));return await t.done,r}catch(e){if(e instanceof y)er.warn(e.message);else{let t=ed.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});er.warn(t.message)}}}async function eE(e,t){try{let r=(await e_()).transaction(ev,"readwrite"),n=r.objectStore(ev);await n.put(t,ew(e)),await r.done}catch(e){if(e instanceof y)er.warn(e.message);else{let t=ed.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});er.warn(t.message)}}}function ew(e){return`${e.name}!${e.options.appId}`}class eb{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new ek(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{let r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=eT();if((null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(e=>e.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:r}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){er.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=eT(),{heartbeatsToSend:r,unsentEntries:n}=function(e,t=1024){let r=[],n=e.slice();for(let i of e){let e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),eS(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),eS(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}(this._heartbeatsCache.heartbeats),i=c(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return er.warn(e),""}}}function eT(){return new Date().toISOString().substring(0,10)}class ek{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{var e;t((null==(e=i.error)?void 0:e.message)||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await ey(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let r=await this.read();return eE(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let r=await this.read();return eE(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}}}function eS(e){return c(JSON.stringify({version:2,heartbeats:e})).length}function eC(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)0>t.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}function eA(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}ec(new O("platform-logger",e=>new Q(e),"PRIVATE")),ec(new O("heartbeat",e=>new eb(e),"PRIVATE")),eg(ee,et,""),eg(ee,et,"esm2017"),eg("fire-js",""),eg("firebase","11.9.1","app"),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;let eP=new E("auth","Firebase",eA()),eR=new H("@firebase/auth");function eO(e,...t){eR.logLevel<=r.ERROR&&eR.error(`Auth (${ef}): ${e}`,...t)}function eN(e,...t){throw eU(e,...t)}function eL(e,...t){return eU(e,...t)}function eD(e,t,r){return new E("auth","Firebase",Object.assign(Object.assign({},eA()),{[t]:r})).create(t,{appName:e.name})}function eM(e){return eD(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function eU(e,...t){if("string"!=typeof e){let r=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)}return eP.create(e,...t)}function eF(e,t,...r){if(!e)throw eU(t,...r)}function ej(e){let t="INTERNAL ASSERTION FAILED: "+e;throw eO(t),Error(t)}function ex(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.href)||""}function eH(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.protocol)||null}class eV{constructor(e,t){var r;this.shortDelay=e,this.longDelay=t,r="Short delay should be less than long delay!",t>e||ej(r),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(_())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===eH()||"https:"===eH()||function(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function eB(e,t){var r,n;r=e.emulator,n="Emulator should always be set here",r||ej(n);let{url:i}=e.emulator;return t?`${i}${t.startsWith("/")?t.slice(1):t}`:i}class eW{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void ej("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void ej("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void ej("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let e$={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},ez=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],eG=new eV(3e4,6e4);function eq(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function eK(e,t,r,n,i={}){return eJ(e,i,async()=>{let i={},s={};n&&("GET"===t?s=n:i={body:JSON.stringify(n)});let a=k(Object.assign({key:e.config.apiKey},s)).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);let l=Object.assign({method:t,headers:o},i);return("undefined"==typeof navigator||"Cloudflare-Workers"!==navigator.userAgent)&&(l.referrerPolicy="no-referrer"),e.emulatorConfig&&m(e.emulatorConfig.host)&&(l.credentials="include"),eW.fetch()(await eX(e,e.config.apiHost,r,a),l)})}async function eJ(e,t,r){e._canInitEmulator=!1;let n=Object.assign(Object.assign({},e$),t);try{let t=new eZ(e),i=await Promise.race([r(),t.promise]);t.clearNetworkTimeout();let s=await i.json();if("needConfirmation"in s)throw eQ(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{let[t,r]=(i.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw eQ(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw eQ(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw eQ(e,"user-disabled",s);let a=n[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(r)throw eD(e,a,r);eN(e,a)}}catch(t){if(t instanceof y)throw t;eN(e,"network-request-failed",{message:String(t)})}}async function eY(e,t,r,n,i={}){let s=await eK(e,t,r,n,i);return"mfaPendingCredential"in s&&eN(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function eX(e,t,r,n){let i=`${t}${r}?${n}`,s=e.config.emulator?eB(e.config,i):`${e.config.apiScheme}://${i}`;return ez.includes(r)&&(await e._persistenceManagerAvailable,"COOKIE"===e._getPersistenceType())?e._getPersistence()._getFinalTarget(s).toString():s}class eZ{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(eL(this.auth,"network-request-failed")),eG.get())})}}function eQ(e,t,r){let n={appName:e.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);let i=eL(e,t,n);return i.customData._tokenResponse=r,i}function e1(e){return void 0!==e&&void 0!==e.enterprise}class e0{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)switch(t.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function e6(e,t){return eK(e,"GET","/v2/recaptchaConfig",eq(e,t))}async function e3(e,t){return eK(e,"POST","/v1/accounts:delete",t)}async function e4(e,t){return eK(e,"POST","/v1/accounts:lookup",t)}function e2(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function e5(e,t=!1){let r=R(e),n=await r.getIdToken(t),i=e7(n);eF(i&&i.exp&&i.auth_time&&i.iat,r.auth,"internal-error");let s="object"==typeof i.firebase?i.firebase:void 0,a=null==s?void 0:s.sign_in_provider;return{claims:i,token:n,authTime:e2(e8(i.auth_time)),issuedAtTime:e2(e8(i.iat)),expirationTime:e2(e8(i.exp)),signInProvider:a||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}function e8(e){return 1e3*Number(e)}function e7(e){let[t,r,n]=e.split(".");if(void 0===t||void 0===r||void 0===n)return eO("JWT malformed, contained fewer than 3 sections"),null;try{let e=u(r);if(!e)return eO("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return eO("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function e9(e){let t=e7(e);return eF(t,"internal-error"),eF(void 0!==t.exp,"internal-error"),eF(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function te(e,t,r=!1){if(r)return t;try{return await t}catch(t){throw t instanceof y&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class tt{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(!e)return this.errorBackoff=3e4,Math.max(0,(null!=(t=this.user.stsTokenManager.expirationTime)?t:0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(null==e?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class tr{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=e2(this.lastLoginAt),this.creationTime=e2(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function tn(e){var t,r,n;let i=e.auth,s=await e.getIdToken(),a=await te(e,e4(i,{idToken:s}));eF(null==a?void 0:a.users.length,i,"internal-error");let o=a.users[0];e._notifyReloadListener(o);let l=(null==(t=o.providerUserInfo)?void 0:t.length)?ts(o.providerUserInfo):[],c=(r=e.providerData,n=l,[...r.filter(e=>!n.some(t=>t.providerId===e.providerId)),...n]),u=e.isAnonymous,h=!(e.email&&o.passwordHash)&&!(null==c?void 0:c.length);Object.assign(e,{uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:c,metadata:new tr(o.createdAt,o.lastLoginAt),isAnonymous:!!u&&h})}async function ti(e){let t=R(e);await tn(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function ts(e){return e.map(e=>{var{providerId:t}=e,r=eC(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}async function ta(e,t){let r=await eJ(e,{},async()=>{let r=k({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:i}=e.config,s=await eX(e,n,"/v1/token",`key=${i}`),a=await e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";let o={method:"POST",headers:a,body:r};return e.emulatorConfig&&m(e.emulatorConfig.host)&&(o.credentials="include"),eW.fetch()(s,o)});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function to(e,t){return eK(e,"POST","/v2/accounts:revokeToken",eq(e,t))}class tl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){eF(e.idToken,"internal-error"),eF(void 0!==e.idToken,"internal-error"),eF(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):e9(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){eF(0!==e.length,"internal-error");let t=e9(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(eF(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:r,refreshToken:n,expiresIn:i}=await ta(e,t);this.updateTokensAndExpiration(r,n,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){let{refreshToken:r,accessToken:n,expirationTime:i}=t,s=new tl;return r&&(eF("string"==typeof r,"internal-error",{appName:e}),s.refreshToken=r),n&&(eF("string"==typeof n,"internal-error",{appName:e}),s.accessToken=n),i&&(eF("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new tl,this.toJSON())}_performRefresh(){return ej("not implemented")}}function tc(e,t){eF("string"==typeof e||void 0===e,"internal-error",{appName:t})}class tu{constructor(e){var{uid:t,auth:r,stsTokenManager:n}=e,i=eC(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new tt(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new tr(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){let t=await te(this,this.stsTokenManager.getToken(this.auth,e));return eF(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return e5(this,e)}reload(){return ti(this)}_assign(e){this!==e&&(eF(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new tu(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){eF(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await tn(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(eh(this.auth.app))return Promise.reject(eM(this.auth));let e=await this.getIdToken();return await te(this,e3(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,n,i,s,a,o,l,c;let u=null!=(r=t.displayName)?r:void 0,h=null!=(n=t.email)?n:void 0,d=null!=(i=t.phoneNumber)?i:void 0,p=null!=(s=t.photoURL)?s:void 0,f=null!=(a=t.tenantId)?a:void 0,m=null!=(o=t._redirectEventId)?o:void 0,g=null!=(l=t.createdAt)?l:void 0,v=null!=(c=t.lastLoginAt)?c:void 0,{uid:I,emailVerified:_,isAnonymous:y,providerData:E,stsTokenManager:w}=t;eF(I&&w,e,"internal-error");let b=tl.fromJSON(this.name,w);eF("string"==typeof I,e,"internal-error"),tc(u,e.name),tc(h,e.name),eF("boolean"==typeof _,e,"internal-error"),eF("boolean"==typeof y,e,"internal-error"),tc(d,e.name),tc(p,e.name),tc(f,e.name),tc(m,e.name),tc(g,e.name),tc(v,e.name);let T=new tu({uid:I,auth:e,email:h,emailVerified:_,displayName:u,isAnonymous:y,photoURL:p,phoneNumber:d,tenantId:f,stsTokenManager:b,createdAt:g,lastLoginAt:v});return E&&Array.isArray(E)&&(T.providerData=E.map(e=>Object.assign({},e))),m&&(T._redirectEventId=m),T}static async _fromIdTokenResponse(e,t,r=!1){let n=new tl;n.updateFromServerResponse(t);let i=new tu({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:r});return await tn(i),i}static async _fromGetAccountInfoResponse(e,t,r){let n=t.users[0];eF(void 0!==n.localId,"internal-error");let i=void 0!==n.providerUserInfo?ts(n.providerUserInfo):[],s=!(n.email&&n.passwordHash)&&!(null==i?void 0:i.length),a=new tl;a.updateFromIdToken(r);let o=new tu({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:s});return Object.assign(o,{uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:i,metadata:new tr(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!(null==i?void 0:i.length)}),o}}let th=new Map;function td(e){var t,r;t="Expected a class definition",e instanceof Function||ej(t);let n=th.get(e);return n?(r="Instance stored in cache mismatched with class",n instanceof e||ej(r)):(n=new e,th.set(e,n)),n}class tp{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function tf(e,t,r){return`firebase:${e}:${t}:${r}`}tp.type="NONE";class tm{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:n,name:i}=this.auth;this.fullUserKey=tf(this.userKey,n.apiKey,i),this.fullPersistenceKey=tf("persistence",n.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await e4(this.auth,{idToken:e}).catch(()=>void 0);return t?tu._fromGetAccountInfoResponse(this.auth,t,e):null}return tu._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new tm(td(tp),e,r);let n=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=n[0]||td(tp),s=tf(r,e.config.apiKey,e.name),a=null;for(let r of t)try{let t=await r._get(s);if(t){let n;if("string"==typeof t){let r=await e4(e,{idToken:t}).catch(()=>void 0);if(!r)break;n=await tu._fromGetAccountInfoResponse(e,r,t)}else n=tu._fromJSON(e,t);r!==i&&(a=n),i=r;break}}catch(e){}let o=n.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&o.length&&(i=o[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new tm(i,e,r)}}function tg(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(ty(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(tv(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(tw(t))return"Blackberry";if(tb(t))return"Webos";if(tI(t))return"Safari";if((t.includes("chrome/")||t_(t))&&!t.includes("edge/"))return"Chrome";if(tE(t))return"Android";let r=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if((null==r?void 0:r.length)===2)return r[1]}return"Other"}function tv(e=_()){return/firefox\//i.test(e)}function tI(e=_()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function t_(e=_()){return/crios\//i.test(e)}function ty(e=_()){return/iemobile/i.test(e)}function tE(e=_()){return/android/i.test(e)}function tw(e=_()){return/blackberry/i.test(e)}function tb(e=_()){return/webos/i.test(e)}function tT(e=_()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function tk(e=_()){return tT(e)||tE(e)||tb(e)||tw(e)||/windows phone/i.test(e)||ty(e)}function tS(e,t=[]){let r;switch(e){case"Browser":r=tg(_());break;case"Worker":r=`${tg(_())}-${e}`;break;default:r=e}let n=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${ef}/${n}`}class tC{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=t=>new Promise((r,n)=>{try{let n=e(t);r(n)}catch(e){n(e)}});r.onAbort=t,this.queue.push(r);let n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}async function tA(e,t={}){return eK(e,"GET","/v2/passwordPolicy",eq(e,t))}class tP{constructor(e){var t,r,n,i;let s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!=(t=s.minPasswordLength)?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!=(n=null==(r=e.allowedNonAlphanumericCharacters)?void 0:r.join(""))?n:"",this.forceUpgradeOnSignin=null!=(i=e.forceUpgradeOnSignin)&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,n,i,s,a;let o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null==(t=o.meetsMinPasswordLength)||t),o.isValid&&(o.isValid=null==(r=o.meetsMaxPasswordLength)||r),o.isValid&&(o.isValid=null==(n=o.containsLowercaseLetter)||n),o.isValid&&(o.isValid=null==(i=o.containsUppercaseLetter)||i),o.isValid&&(o.isValid=null==(s=o.containsNumericCharacter)||s),o.isValid&&(o.isValid=null==(a=o.containsNonAlphanumericCharacter)||a),o}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)r=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,n,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class tR{constructor(e,t,r,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new tO(this),this.idTokenSubscription=new tO(this),this.beforeStateQueue=new tC(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=eP,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=td(t)),this._initializationPromise=this.queue(async()=>{var r,n,i;if(!this._deleted){if(this.persistenceManager=await tm.create(this,e),null==(r=this._resolvePersistenceManagerAvailable)||r.call(this),!this._deleted){if(null==(n=this._popupRedirectResolver)?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null==(i=this.currentUser)?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await e4(this,{idToken:e}),r=await tu._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(eh(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let r=await this.assertedPersistence.getCurrentUser(),n=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let r=null==(t=this.redirectUser)?void 0:t._redirectEventId,s=null==n?void 0:n._redirectEventId,a=await this.tryRedirectSignIn(e);(!r||r===s)&&(null==a?void 0:a.user)&&(n=a.user,i=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(n)}catch(e){n=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return(eF(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId)?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await tn(e)}catch(e){if((null==e?void 0:e.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(eh(this.app))return Promise.reject(eM(this));let t=e?R(e):null;return t&&eF(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&eF(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return eh(this.app)?Promise.reject(eM(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return eh(this.app)?Promise.reject(eM(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(td(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new tP(await tA(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new E("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await to(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null==(e=this._currentUser)?void 0:e.toJSON()}}async _setRedirectUser(e,t){let r=await this.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&td(e)||this._popupRedirectResolver;eF(t,this,"argument-error"),this.redirectPersistenceManager=await tm.create(this,[td(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return(this._isInitialized&&await this.queue(async()=>{}),(null==(t=this._currentUser)?void 0:t._redirectEventId)===e)?this._currentUser:(null==(r=this.redirectUser)?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=null!=(t=null==(e=this.currentUser)?void 0:e.uid)?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,n){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),s=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(eF(a,this,"internal-error"),a.then(()=>{s||i(this.currentUser)}),"function"==typeof t){let i=e.addObserver(t,r,n);return()=>{s=!0,i()}}{let r=e.addObserver(t);return()=>{s=!0,r()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return eF(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=tS(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=await (null==(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);let n=await this._getAppCheckToken();return n&&(t["X-Firebase-AppCheck"]=n),t}async _getAppCheckToken(){var e;if(eh(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=await (null==(e=this.appCheckServiceProvider.getImmediate({optional:!0}))?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){eR.logLevel<=r.WARN&&eR.warn(`Auth (${ef}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}class tO{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){let r=new A(e,void 0);return r.subscribe.bind(r)}(e=>this.observer=e)}get next(){return eF(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let tN={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function tL(e){return`__${e}${Math.floor(1e6*Math.random())}`}class tD{constructor(){this.enterprise=new tM}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class tM{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let tU="NO_RECAPTCHA";class tF{constructor(e){this.type="recaptcha-enterprise",this.auth=R(e)}async verify(e="verify",t=!1){async function r(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,r)=>{e6(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(n=>{if(void 0===n.recaptchaKey)r(Error("recaptcha Enterprise site key undefined"));else{let r=new e0(n);return null==e.tenantId?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,t(r.siteKey)}}).catch(e=>{r(e)})})}function n(t,r,n){let i=window.grecaptcha;e1(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{r(e)}).catch(()=>{r(tU)})}):n(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new tD().execute("siteKey",{action:"verify"}):new Promise((e,i)=>{r(this.auth).then(r=>{if(!t&&e1(window.grecaptcha))n(r,e,i);else{var s;if("undefined"==typeof window)return void i(Error("RecaptchaVerifier is only supported in browser"));let t=tN.recaptchaEnterpriseScript;0!==t.length&&(t+=r),(s=t,tN.loadJS(s)).then(()=>{n(r,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function tj(e,t,r,n=!1,i=!1){let s,a=new tF(e);if(i)s=tU;else try{s=await a.verify(r)}catch(e){s=await a.verify(r,!0)}let o=Object.assign({},t);if("mfaSmsEnrollment"===r||"mfaSmsSignIn"===r){if("phoneEnrollmentInfo"in o){let e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){let e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return n?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function tx(e,t,r,n,i){var s,a;if("EMAIL_PASSWORD_PROVIDER"===i)if(null==(s=e._getRecaptchaConfig())||!s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return n(e,t).catch(async i=>{if("auth/missing-recaptcha-token"!==i.code)return Promise.reject(i);{console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let i=await tj(e,t,r,"getOobCode"===r);return n(e,i)}});else{let i=await tj(e,t,r,"getOobCode"===r);return n(e,i)}if("PHONE_PROVIDER"!==i)return Promise.reject(i+" provider is not supported.");if(null==(a=e._getRecaptchaConfig())?void 0:a.isProviderEnabled("PHONE_PROVIDER")){let i=await tj(e,t,r);return n(e,i).catch(async i=>{var s;if((null==(s=e._getRecaptchaConfig())?void 0:s.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${r} flow.`);let i=await tj(e,t,r,!1,!0);return n(e,i)}return Promise.reject(i)})}{let i=await tj(e,t,r,!1,!0);return n(e,i)}}async function tH(e){let t=R(e),r=new e0(await e6(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()&&new tF(t).verify()}function tV(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function tB(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class tW{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ej("not implemented")}_getIdTokenResponse(e){return ej("not implemented")}_linkToIdToken(e,t){return ej("not implemented")}_getReauthenticationResolver(e){return ej("not implemented")}}async function t$(e,t){return eK(e,"POST","/v1/accounts:signUp",t)}async function tz(e,t){return eY(e,"POST","/v1/accounts:signInWithPassword",eq(e,t))}async function tG(e,t){return eY(e,"POST","/v1/accounts:signInWithEmailLink",eq(e,t))}async function tq(e,t){return eY(e,"POST","/v1/accounts:signInWithEmailLink",eq(e,t))}class tK extends tW{constructor(e,t,r,n=null){super("password",r),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new tK(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new tK(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return tx(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",tz,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return tG(e,{email:this._email,oobCode:this._password});default:eN(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return tx(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",t$,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return tq(e,{idToken:t,email:this._email,oobCode:this._password});default:eN(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function tJ(e,t){return eY(e,"POST","/v1/accounts:signInWithIdp",eq(e,t))}class tY extends tW{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new tY(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):eN("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e,{providerId:r,signInMethod:n}=t,i=eC(t,["providerId","signInMethod"]);if(!r||!n)return null;let s=new tY(r,n);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return tJ(e,this.buildRequest())}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,tJ(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,tJ(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=k(t)}return e}}async function tX(e,t){return eK(e,"POST","/v1/accounts:sendVerificationCode",eq(e,t))}async function tZ(e,t){return eY(e,"POST","/v1/accounts:signInWithPhoneNumber",eq(e,t))}async function tQ(e,t){let r=await eY(e,"POST","/v1/accounts:signInWithPhoneNumber",eq(e,t));if(r.temporaryProof)throw eQ(e,"account-exists-with-different-credential",r);return r}let t1={USER_NOT_FOUND:"user-not-found"};async function t0(e,t){return eY(e,"POST","/v1/accounts:signInWithPhoneNumber",eq(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),t1)}class t6 extends tW{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new t6({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new t6({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return tZ(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return tQ(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return t0(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:n}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:n}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}=e;return r||t||n||i?new t6({verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}):null}}class t3{constructor(e){var t,r,n,i,s,a;let o=S(C(e)),l=null!=(t=o.apiKey)?t:null,c=null!=(r=o.oobCode)?r:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!=(n=o.mode)?n:null);eF(l&&c&&u,"argument-error"),this.apiKey=l,this.operation=u,this.code=c,this.continueUrl=null!=(i=o.continueUrl)?i:null,this.languageCode=null!=(s=o.lang)?s:null,this.tenantId=null!=(a=o.tenantId)?a:null}static parseLink(e){let t=function(e){let t=S(C(e)).link,r=t?S(C(t)).deep_link_id:null,n=S(C(e)).deep_link_id;return(n?S(C(n)).link:null)||n||r||t||e}(e);try{return new t3(t)}catch(e){return null}}}class t4{constructor(){this.providerId=t4.PROVIDER_ID}static credential(e,t){return tK._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let r=t3.parseLink(t);return eF(r,"argument-error"),tK._fromEmailAndCode(e,r.code,r.tenantId)}}t4.PROVIDER_ID="password",t4.EMAIL_PASSWORD_SIGN_IN_METHOD="password",t4.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class t2{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class t5 extends t2{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class t8 extends t5{constructor(){super("facebook.com")}static credential(e){return tY._fromParams({providerId:t8.PROVIDER_ID,signInMethod:t8.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return t8.credentialFromTaggedObject(e)}static credentialFromError(e){return t8.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return t8.credential(e.oauthAccessToken)}catch(e){return null}}}t8.FACEBOOK_SIGN_IN_METHOD="facebook.com",t8.PROVIDER_ID="facebook.com";class t7 extends t5{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return tY._fromParams({providerId:t7.PROVIDER_ID,signInMethod:t7.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return t7.credentialFromTaggedObject(e)}static credentialFromError(e){return t7.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return t7.credential(t,r)}catch(e){return null}}}t7.GOOGLE_SIGN_IN_METHOD="google.com",t7.PROVIDER_ID="google.com";class t9 extends t5{constructor(){super("github.com")}static credential(e){return tY._fromParams({providerId:t9.PROVIDER_ID,signInMethod:t9.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return t9.credentialFromTaggedObject(e)}static credentialFromError(e){return t9.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return t9.credential(e.oauthAccessToken)}catch(e){return null}}}t9.GITHUB_SIGN_IN_METHOD="github.com",t9.PROVIDER_ID="github.com";class re extends t5{constructor(){super("twitter.com")}static credential(e,t){return tY._fromParams({providerId:re.PROVIDER_ID,signInMethod:re.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return re.credentialFromTaggedObject(e)}static credentialFromError(e){return re.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return re.credential(t,r)}catch(e){return null}}}re.TWITTER_SIGN_IN_METHOD="twitter.com",re.PROVIDER_ID="twitter.com";class rt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,n=!1){return new rt({user:await tu._fromIdTokenResponse(e,r,n),providerId:rr(r),_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){return await e._updateTokensIfNecessary(r,!0),new rt({user:e,providerId:rr(r),_tokenResponse:r,operationType:t})}}function rr(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class rn extends y{constructor(e,t,r,n){var i;super(t.code,t.message),this.operationType=r,this.user=n,Object.setPrototypeOf(this,rn.prototype),this.customData={appName:e.name,tenantId:null!=(i=e.tenantId)?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,n){return new rn(e,t,r,n)}}function ri(e,t,r,n){return("reauthenticate"===t?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(r=>{if("auth/multi-factor-auth-required"===r.code)throw rn._fromErrorAndOperation(e,r,t,n);throw r})}async function rs(e,t,r=!1){let n=await te(e,t._linkToIdToken(e.auth,await e.getIdToken()),r);return rt._forOperation(e,"link",n)}async function ra(e,t,r=!1){let{auth:n}=e;if(eh(n.app))return Promise.reject(eM(n));let i="reauthenticate";try{let s=await te(e,ri(n,i,t,e),r);eF(s.idToken,n,"internal-error");let a=e7(s.idToken);eF(a,n,"internal-error");let{sub:o}=a;return eF(e.uid===o,n,"user-mismatch"),rt._forOperation(e,i,s)}catch(e){throw(null==e?void 0:e.code)==="auth/user-not-found"&&eN(n,"user-mismatch"),e}}async function ro(e,t,r=!1){if(eh(e.app))return Promise.reject(eM(e));let n="signIn",i=await ri(e,n,t),s=await rt._fromIdTokenResponse(e,n,i);return r||await e._updateCurrentUser(s.user),s}async function rl(e,t){return eY(e,"POST","/v1/accounts:signInWithCustomToken",eq(e,t))}async function rc(e,t){if(eh(e.app))return Promise.reject(eM(e));let r=R(e),n=await rl(r,{token:t,returnSecureToken:!0}),i=await rt._fromIdTokenResponse(r,"signIn",n);return await r._updateCurrentUser(i.user),i}function ru(e,t,r,n){return R(e).onAuthStateChanged(t,r,n)}function rh(e,t){return eK(e,"POST","/v2/accounts/mfaEnrollment:start",eq(e,t))}new WeakMap;let rd="__sak";class rp{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(rd,"1"),this.storage.removeItem(rd),Promise.resolve(!0)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class rf extends rp{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=tk(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let r=this.storage.getItem(t),n=this.localCache[t];r!==n&&e(t,n,r)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,r)=>{this.notifyListeners(e,r)});let r=e.key;t?this.detachListener():this.stopPolling();let n=()=>{let e=this.storage.getItem(r);(t||this.localCache[r]!==e)&&this.notifyListeners(r,e)},i=this.storage.getItem(r);(function(){let e=_();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0})()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let e of Array.from(r))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}rf.type="LOCAL";class rm extends rp{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}rm.type="SESSION";class rg{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let r=new rg(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:r,data:n}=e.data,i=this.handlersMap[r];if(!(null==i?void 0:i.size))return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:r});let s=Array.from(i).map(async t=>t(e.origin,n)),a=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function rv(e="",t=10){let r="";for(let e=0;e<t;e++)r+=Math.floor(10*Math.random());return e+r}rg.receivers=[];class rI{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){let n,i,s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((a,o)=>{let l=rv("",20);s.port1.start();let c=setTimeout(()=>{o(Error("unsupported_event"))},r);i={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(c),n=setTimeout(()=>{o(Error("timeout"))},3e3);break;case"done":clearTimeout(n),a(e.data.response);break;default:clearTimeout(c),clearTimeout(n),o(Error("invalid_response"))}}},this.handlers.add(i),s.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function r_(){return window}function ry(){return void 0!==r_().WorkerGlobalScope&&"function"==typeof r_().importScripts}async function rE(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}let rw="firebaseLocalStorageDb",rb="firebaseLocalStorage",rT="fbase_key";class rk{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function rS(e,t){return e.transaction([rb],t?"readwrite":"readonly").objectStore(rb)}function rC(){let e=indexedDB.open(rw,1);return new Promise((t,r)=>{e.addEventListener("error",()=>{r(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(rb,{keyPath:rT})}catch(e){r(e)}}),e.addEventListener("success",async()=>{let r=e.result;r.objectStoreNames.contains(rb)?t(r):(r.close(),await new rk(indexedDB.deleteDatabase(rw)).toPromise(),t(await rC()))})})}async function rA(e,t,r){return new rk(rS(e,!0).put({[rT]:t,value:r})).toPromise()}async function rP(e,t){let r=rS(e,!1).get(t),n=await new rk(r).toPromise();return void 0===n?null:n.value}function rR(e,t){return new rk(rS(e,!0).delete(t)).toPromise()}class rO{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await rC()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ry()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=rg._getInstance(ry()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await rE(),!this.activeServiceWorker)return;this.sender=new rI(this.activeServiceWorker);let r=await this.sender._send("ping",{},800);r&&(null==(e=r[0])?void 0:e.fulfilled)&&(null==(t=r[0])?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null==(t=null==navigator?void 0:navigator.serviceWorker)?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await rC();return await rA(e,rd,"1"),await rR(e,rd),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>rA(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>rP(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>rR(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new rk(rS(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],r=new Set;if(0!==e.length)for(let{fbase_key:n,value:i}of e)r.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(i)&&(this.notifyListeners(n,i),t.push(n));for(let e of Object.keys(this.localCache))this.localCache[e]&&!r.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let e of Array.from(r))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function rN(e,t){return eK(e,"POST","/v2/accounts/mfaSignIn:start",eq(e,t))}rO.type="LOCAL",tL("rcb"),new eV(3e4,6e4);let rL="recaptcha";async function rD(e,t,r){var n;if(!e._getRecaptchaConfig())try{await tH(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"==typeof t?{phoneNumber:t}:t,"session"in i){let t=i.session;if("phoneNumber"in i){eF("enroll"===t.type,e,"internal-error");let n={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===tU){eF((null==r?void 0:r.type)===rL,e,"argument-error");let n=await rM(e,t,r);return rh(e,n)}return rh(e,t)},a=tx(e,n,"mfaSmsEnrollment",s,"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{eF("signin"===t.type,e,"internal-error");let s=(null==(n=i.multiFactorHint)?void 0:n.uid)||i.multiFactorUid;eF(s,e,"missing-multi-factor-info");let a={mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},o=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===tU){eF((null==r?void 0:r.type)===rL,e,"argument-error");let n=await rM(e,t,r);return rN(e,n)}return rN(e,t)},l=tx(e,a,"mfaSmsSignIn",o,"PHONE_PROVIDER");return(await l.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},n=async(e,t)=>{if(t.captchaResponse===tU){eF((null==r?void 0:r.type)===rL,e,"argument-error");let n=await rM(e,t,r);return tX(e,n)}return tX(e,t)},s=tx(e,t,"sendVerificationCode",n,"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).sessionInfo}}finally{null==r||r._reset()}}async function rM(e,t,r){eF(r.type===rL,e,"argument-error");let n=await r.verify();eF("string"==typeof n,e,"argument-error");let i=Object.assign({},t);if("phoneEnrollmentInfo"in i){let e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,r=i.phoneEnrollmentInfo.clientType,s=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:n,captchaResponse:t,clientType:r,recaptchaVersion:s}}),i}if(!("phoneSignInInfo"in i))return Object.assign(i,{recaptchaToken:n}),i;{let e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,r=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:n,captchaResponse:e,clientType:t,recaptchaVersion:r}}),i}}class rU{constructor(e){this.providerId=rU.PROVIDER_ID,this.auth=R(e)}verifyPhoneNumber(e,t){return rD(this.auth,e,R(t))}static credential(e,t){return t6._fromVerification(e,t)}static credentialFromResult(e){return rU.credentialFromTaggedObject(e)}static credentialFromError(e){return rU.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:r}=e;return t&&r?t6._fromTokenResponse(t,r):null}}rU.PROVIDER_ID="phone",rU.PHONE_SIGN_IN_METHOD="phone";class rF extends tW{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return tJ(e,this._buildIdpRequest())}_linkToIdToken(e,t){return tJ(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return tJ(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function rj(e){return ro(e.auth,new rF(e),e.bypassAuthState)}function rx(e){let{auth:t,user:r}=e;return eF(r,t,"internal-error"),ra(r,new rF(e),e.bypassAuthState)}async function rH(e){let{auth:t,user:r}=e;return eF(r,t,"internal-error"),rs(r,new rF(e),e.bypassAuthState)}class rV{constructor(e,t,r,n,i=!1){this.auth=e,this.resolver=r,this.user=n,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:r,postBody:n,tenantId:i,error:s,type:a}=e;if(s)return void this.reject(s);let o={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return rj;case"linkViaPopup":case"linkViaRedirect":return rH;case"reauthViaPopup":case"reauthViaRedirect":return rx;default:eN(this.auth,"internal-error")}}resolve(e){var t,r;t=this.pendingPromise,r="Pending promise was never set",t||ej(r),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,r;t=this.pendingPromise,r="Pending promise was never set",t||ej(r),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let rB=new eV(2e3,1e4);class rW extends rV{constructor(e,t,r,n,i){super(e,t,n,i),this.provider=r,this.authWindow=null,this.pollId=null,rW.currentPopupAction&&rW.currentPopupAction.cancel(),rW.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return eF(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||ej(t);let r=rv();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],r),this.authWindow.associatedEvent=r,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(eL(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null==(e=this.authWindow)?void 0:e.associatedEvent)||null}cancel(){this.reject(eL(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,rW.currentPopupAction=null}pollUserCancellation(){let e=()=>{var t,r;if(null==(r=null==(t=this.authWindow)?void 0:t.window)?void 0:r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(eL(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,rB.get())};e()}}rW.currentPopupAction=null;let r$=new Map;class rz extends rV{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=r$.get(this.auth._key());if(!e){try{let t=await rG(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}r$.set(this.auth._key(),e)}return this.bypassAuthState||r$.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function rG(e,t){var r;let n=tf("pendingRedirect",(r=t).config.apiKey,r.name),i=td(e._redirectPersistence);if(!await i._isAvailable())return!1;let s=await i._get(n)==="true";return await i._remove(n),s}function rq(e,t){r$.set(e._key(),t)}async function rK(e,t,r=!1){if(eh(e.app))return Promise.reject(eM(e));let n=R(e),i=t?td(t):(eF(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver),s=new rz(n,i,r),a=await s.execute();return a&&!r&&(delete a.user._redirectEventId,await n._persistUserIfCurrent(a.user),await n._setRedirectUser(null,t)),a}class rJ{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return rX(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!rX(e)){let n=(null==(r=e.error.code)?void 0:r.split("auth/")[1])||"internal-error";t.onError(eL(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(rY(e))}saveEventToCache(e){this.cachedEventUids.add(rY(e)),this.lastProcessedEventTime=Date.now()}}function rY(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function rX({type:e,error:t}){return"unknown"===e&&(null==t?void 0:t.code)==="auth/no-auth-event"}async function rZ(e,t={}){return eK(e,"GET","/v1/projects",t)}let rQ=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,r1=/^https?/;async function r0(e){if(e.config.emulator)return;let{authorizedDomains:t}=await rZ(e);for(let e of t)try{if(function(e){let t=ex(),{protocol:r,hostname:n}=new URL(t);if(e.startsWith("chrome-extension://")){let i=new URL(e);return""===i.hostname&&""===n?"chrome-extension:"===r&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===r&&i.hostname===n}if(!r1.test(r))return!1;if(rQ.test(e))return n===e;let i=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+i+"|"+i+")$","i").test(n)}(e))return}catch(e){}eN(e,"unauthorized-domain")}let r6=new eV(3e4,6e4);function r3(){let e=r_().___jsl;if(null==e?void 0:e.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let r4=null,r2=new eV(5e3,15e3),r5={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},r8=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function r7(e){let t=await (r4=r4||new Promise((t,r)=>{var n,i,s,a;function o(){r3(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{r3(),r(eL(e,"network-request-failed"))},timeout:r6.get()})}if(null==(i=null==(n=r_().gapi)?void 0:n.iframes)?void 0:i.Iframe)t(gapi.iframes.getContext());else if(null==(s=r_().gapi)?void 0:s.load)o();else{let t=tL("iframefcb");return r_()[t]=()=>{gapi.load?o():r(eL(e,"network-request-failed"))},(a=`${tN.gapiScript}?onload=${t}`,tN.loadJS(a)).catch(e=>r(e))}}).catch(e=>{throw r4=null,e})),r=r_().gapi;return eF(r,e,"internal-error"),t.open({where:document.body,url:function(e){let t=e.config;eF(t.authDomain,e,"auth-domain-config-required");let r=t.emulator?eB(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,n={apiKey:t.apiKey,appName:e.name,v:ef},i=r8.get(e.config.apiHost);i&&(n.eid=i);let s=e._getFrameworks();return s.length&&(n.fw=s.join(",")),`${r}?${k(n).slice(1)}`}(e),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:r5,dontclear:!0},t=>new Promise(async(r,n)=>{await t.restyle({setHideOnLeave:!1});let i=eL(e,"network-request-failed"),s=r_().setTimeout(()=>{n(i)},r2.get());function a(){r_().clearTimeout(s),r(t)}t.ping(a).then(a,()=>{n(i)})}))}let r9={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class ne{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let nt=encodeURIComponent("fac");async function nr(e,t,r,n,i,s){eF(e.config.authDomain,e,"auth-domain-config-required"),eF(e.config.apiKey,e,"invalid-api-key");let a={apiKey:e.config.apiKey,appName:e.name,authType:r,redirectUrl:n,v:ef,eventId:i};if(t instanceof t2)for(let[r,n]of(t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",!function(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())&&(a.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(s||{})))a[r]=n;if(t instanceof t5){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(a.scopes=e.join(","))}for(let t of(e.tenantId&&(a.tid=e.tenantId),Object.keys(a)))void 0===a[t]&&delete a[t];let o=await e._getAppCheckToken(),l=o?`#${nt}=${encodeURIComponent(o)}`:"";return`${function({config:e}){return e.emulator?eB(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${k(a).slice(1)}${l}`}let nn="webStorageSupport",ni=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=rm,this._completeRedirectFn=rK,this._overrideRedirectResult=rq}async _openPopup(e,t,r,n){var i,s,a;s=null==(i=this.eventManagers[e._key()])?void 0:i.manager,a="_initialize() not called before _openPopup()",s||ej(a);let o=await nr(e,t,r,ex(),n);return function(e,t,r,n=500,i=600){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-n)/2,0).toString(),o="",l=Object.assign(Object.assign({},r9),{width:n.toString(),height:i.toString(),top:s,left:a}),c=_().toLowerCase();r&&(o=t_(c)?"_blank":r),tv(c)&&(t=t||"http://localhost",l.scrollbars="yes");let u=Object.entries(l).reduce((e,[t,r])=>`${e}${t}=${r},`,"");if(function(e=_()){var t;return tT(e)&&!!(null==(t=window.navigator)?void 0:t.standalone)}(c)&&"_self"!==o)return function(e,t){let r=document.createElement("a");r.href=e,r.target=t;let n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(n)}(t||"",o),new ne(null);let h=window.open(t||"",o,u);eF(h,e,"popup-blocked");try{h.focus()}catch(e){}return new ne(h)}(e,o,rv())}async _openRedirect(e,t,r,n){var i;return await this._originValidation(e),i=await nr(e,t,r,ex(),n),r_().location.href=i,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var r;let{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(r="If manager is not set, promise should be",n||ej(r),n)}let n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch(()=>{delete this.eventManagers[t]}),n}async initAndGetManager(e){let t=await r7(e),r=new rJ(e);return t.register("authEvent",t=>(eF(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:r.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(nn,{type:nn},r=>{var n;let i=null==(n=null==r?void 0:r[0])?void 0:n[nn];void 0!==i&&t(!!i),eN(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=r0(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return tk()||tI()||tT()}};var ns="@firebase/auth",na="1.10.7";class no{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null==(e=this.auth.currentUser)?void 0:e.uid)||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){eF(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let nl=p("authIdTokenMaxAge")||300,nc=null;tN={loadJS:e=>new Promise((t,r)=>{let n=document.createElement("script");n.setAttribute("src",e),n.onload=t,n.onerror=e=>{let t=eL("internal-error");t.customData=e,r(t)},n.type="text/javascript",n.charset="UTF-8",(function(){var e,t;return null!=(t=null==(e=document.getElementsByTagName("head"))?void 0:e[0])?t:document})().appendChild(n)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},function(e){ec(new O("auth",(t,{options:r})=>{let n=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),s=t.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=n.options;eF(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});let l=new tR(n,i,s,{apiKey:a,authDomain:o,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:tS(e)}),c=(null==r?void 0:r.persistence)||[],u=(Array.isArray(c)?c:[c]).map(td);return(null==r?void 0:r.errorMap)&&l._updateErrorMap(r.errorMap),l._initializeWithPersistence(u,null==r?void 0:r.popupRedirectResolver),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),ec(new O("auth-internal",e=>new no(R(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),eg(ns,na,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(e)),eg(ns,na,"esm2017")}("Browser");let nu=function(e=function(e=en){let t=es.get(e);if(!t&&e===en&&d())return em();if(!t)throw ed.create("no-app",{appName:e});return t}()){var t,r;let n=eu(e,"auth");if(n.isInitialized())return n.getImmediate();let i=function(e,t){let r=eu(e,"auth");if(r.isInitialized()){let e=r.getImmediate();if(b(r.getOptions(),null!=t?t:{}))return e;eN(e,"already-initialized")}return r.initialize({options:t})}(e,{popupRedirectResolver:ni,persistence:[rO,rf,rm]}),s=p("authTokenSyncURL");if(s&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(s,location.origin);if(location.origin===e.origin){let t,r=(t=e.toString(),async e=>{let r=e&&await e.getIdTokenResult(),n=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(n&&n>nl)return;let i=null==r?void 0:r.token;nc!==i&&(nc=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});R(i).beforeAuthStateChanged(r,()=>r(i.currentUser)),R(i).onIdTokenChanged(e=>r(e),void 0,void 0)}}let a=null==(r=null==(t=h())?void 0:t.emulatorHosts)?void 0:r.auth;return a&&function(e,t,r){let n=R(e);eF(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");let i=tV(t),{host:s,port:a}=function(e){let t=tV(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};let n=r[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){let e=i[1];return{host:e,port:tB(n.substr(e.length+1))}}{let[e,t]=n.split(":");return{host:e,port:tB(t)}}}(t),o=null===a?"":`:${a}`,l={url:`${i}//${s}${o}/`},c=Object.freeze({host:s,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!n._canInitEmulator){eF(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),eF(b(l,n.config.emulator)&&b(c,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=l,n.emulatorConfig=c,n.settings.appVerificationDisabledForTesting=!0,m(s)?(g(`${i}//${s}${o}`),function(e,t){if("undefined"==typeof window||"undefined"==typeof document||!m(window.location.host)||v[e]===t||v[e]||I)return;function r(e){return`__firebase__banner__${e}`}v[e]=t;let n="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(v))v[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(n),t=!1,e||((e=document.createElement("div")).setAttribute("id",n),t=!0),{created:t,element:e}),a=r("text"),o=document.getElementById(a)||document.createElement("span"),l=r("learnmore"),c=document.getElementById(l)||document.createElement("a"),u=r("preprendIcon"),h=document.getElementById(u)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e=s.element;e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center",c.setAttribute("id",l),c.innerText="Learn more",c.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",c.setAttribute("target","__blank"),c.style.paddingLeft="5px",c.style.textDecoration="underline";let t=function(){let e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{I=!0;let e=document.getElementById(n);e&&e.remove()},e}();h.setAttribute("width","24"),h.setAttribute("id",u),h.setAttribute("height","24"),h.setAttribute("viewBox","0 0 24 24"),h.setAttribute("fill","none"),h.style.marginLeft="-6px",e.append(h,o,c,t),document.body.appendChild(e)}i?(o.innerText="Preview backend disconnected.",h.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(h.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,o.innerText="Preview backend running in this workspace."),o.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}("Auth",!0)):function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(i,`http://${a}`),i}(em({apiKey:"AIzaSyBbQOpJTZmcGdszjtk_Sk2bKXaC5czmRr8",authDomain:"intrackt-908ae.firebaseapp.com",projectId:"intrackt-908ae",storageBucket:"intrackt-908ae.firebasestorage.app",messagingSenderId:"807157076800",appId:"1:807157076800:web:5a41a3959d754a7916a0a5",measurementId:"G-4L3PZXJ4C9"})),nh={BACKEND_BASE_URL:"http://localhost:3000",AUTH_URL:"/api/auth/auth-url",AUTH_TOKEN:"/api/auth/token",SYNC_EMAILS:"/api/emails",FOLLOWUP_NEEDED:"/api/emails/followup-needed",REPORT_MISCLASSIFICATION:"/api/emails/report-misclassification",UNDO_MISCLASSIFICATION:"/api/emails/undo-misclassification",FETCH_USER_PLAN:"/api/user",UPDATE_USER_PLAN:"/api/user/update-plan",SEND_REPLY:"/api/emails/send-reply",ARCHIVE_EMAIL:"/api/emails/archive"};async function nd(e,t={}){let r=nu.currentUser,n={"Content-Type":"application/json",...t.headers};if(r)try{let e=await r.getIdToken();n.Authorization=`Bearer ${e}`}catch(e){console.error(" Intrackt: Failed to get Firebase ID token:",e)}let i=`${nh.BACKEND_BASE_URL}${e}`;console.log(`\u{1F4E1} Intrackt: Making API call to: ${i} with method: ${t.method||"GET"}`);try{let e=await fetch(i,{...t,headers:n,body:t.body&&"object"==typeof t.body?JSON.stringify(t.body):t.body});if(!e.ok){let t=await e.text();throw console.error(`\u{274C} Intrackt: API Error ${e.status} from ${i}:`,t),Error(`Backend error: ${e.status} - ${t}`)}let r=await e.json();return console.log(`\u{2705} Intrackt: API call to ${i} successful. Response:`,r),r}catch(e){throw console.error(`\u{274C} Intrackt: Network or parsing error for ${i}:`,e),Error(`Network or server error: ${e.message}`)}}async function np(e,t,r,n,i,s){if(!nu.currentUser)throw Error("User not authenticated for sending email.");try{return await nd(nh.SEND_REPLY,{method:"POST",body:{threadId:e,to:t,subject:r,body:n,userEmail:i,userId:s}})}catch(e){throw console.error(" Intrackt: Error sending Gmail reply via backend:",e),e}}async function nf(e,t,r=!1){if(!e||!t)return console.error(" Intrackt Background: Cannot trigger email sync, userEmail or userId is missing."),{success:!1,error:"User email or ID missing for sync."};try{let n=await nd(nh.SYNC_EMAILS,{method:"POST",body:{userEmail:e,userId:t,fullRefresh:r}});if(n.success&&n.categorizedEmails)return await chrome.storage.local.set({appliedEmails:n.categorizedEmails.applied||[],interviewedEmails:n.categorizedEmails.interviewed||[],offersEmails:n.categorizedEmails.offers||[],rejectedEmails:n.categorizedEmails.rejected||[],irrelevantEmails:n.categorizedEmails.irrelevant||[],quotaData:n.quota||null}),console.log(" Intrackt Background: Emails and quota cached successfully in local storage."),chrome.runtime.sendMessage({type:"EMAILS_SYNCED",success:!0,categorizedEmails:n.categorizedEmails,quota:n.quota,userEmail:e}),{success:!0,categorizedEmails:n.categorizedEmails,quota:n.quota};return console.error(" Intrackt Background: Backend sync failed or returned no emails:",n.error),{success:!1,error:n.error||"Backend sync failed or returned no emails."}}catch(e){return console.error(" Intrackt Background: Error during email sync:",e),{success:!1,error:e.message}}}chrome.runtime.onMessage.addListener((e,t,r)=>(console.log(`\u{1F4E9} Intrackt Background: Received message type: ${e.type}`),(async()=>{let t=await chrome.storage.local.get(["userEmail","userId"]),n=t.userId,i=t.userEmail,s=!!nu.currentUser&&!nu.currentUser.isAnonymous,a=!!i&&!!n;if(!s&&!a&&"LOGIN_GOOGLE_OAUTH"!==e.type){console.warn(`Intrackt Background: User not authenticated or user info not cached for message type: ${e.type}.`),r({success:!1,error:"User not authenticated or user info not available."});return}switch(e.type){case"LOGIN_GOOGLE_OAUTH":try{let e=chrome.identity.getRedirectURL(),t=await nd(nh.AUTH_URL,{method:"GET",headers:{"Content-Type":"application/json"},query:{redirect_uri:e}});if(!t.success||!t.url)throw Error(t.error||"Failed to get auth URL from backend.");let n=t.url,i=await new Promise((e,t)=>{chrome.identity.launchWebAuthFlow({url:n,interactive:!0},r=>chrome.runtime.lastError?t(Error(chrome.runtime.lastError.message)):r?void e(r):t(Error("OAuth flow cancelled or failed.")))}),s=new URLSearchParams(new URL(i).search).get("code");if(!s)throw Error("Authorization code not found in redirect URL.");let a=await nd(nh.AUTH_TOKEN,{method:"POST",body:{code:s,redirect_uri:e}});if(a.success&&a.firebaseToken){let e=(await rc(nu,a.firebaseToken)).user;console.log(" Intrackt Background: Successfully signed in to Firebase with custom token."),await chrome.storage.local.set({userEmail:e.email,userName:a.userName||e.email,userId:e.uid,userPlan:a.userPlan||"free"}),await nf(e.email,e.uid,!0),r({success:!0,userEmail:e.email,userName:a.userName,userPlan:a.userPlan,userId:e.uid})}else throw Error(a.error||"Failed to exchange code for Firebase token.")}catch(e){console.error(" Intrackt Background: Error during Google OAuth login:",e),r({success:!1,error:e.message})}break;case"LOGOUT":try{await R(nu).signOut(),console.log(" Intrackt Background: User signed out from Firebase."),r({success:!0})}catch(e){console.error(" Intrackt Background: Error during logout:",e),r({success:!1,error:e.message})}break;case"FETCH_USER_PLAN":try{let t=e.userEmail||i,s=e.userId||n;if(!t||!s)return void r({success:!1,error:"User email or ID not available for fetching plan."});let a=await nd(nh.FETCH_USER_PLAN,{method:"POST",body:{email:t,userId:s}});a.success?(await chrome.storage.local.set({userPlan:a.plan}),r({success:!0,plan:a.plan})):r({success:!1,error:a.error})}catch(e){console.error(" Intrackt Background: Error fetching user plan:",e),r({success:!1,error:e.message})}break;case"UPDATE_USER_PLAN":try{let{newPlan:t,userEmail:i}=e;if(!i||!n)return void r({success:!1,error:"User email or ID not available for updating plan."});let s=await nd(nh.UPDATE_USER_PLAN,{method:"POST",body:{newPlan:t,userEmail:i,userId:n}});s.success&&await chrome.storage.local.set({userPlan:t}),r(s)}catch(e){console.error(" Intrackt Background: Error updating user plan:",e),r({success:!1,error:e.message})}break;case"FETCH_STORED_EMAILS":console.warn("Intrackt Background: Received FETCH_STORED_EMAILS, but popup should read directly from local storage."),r({success:!0,message:"Handled by popup's direct storage access."});break;case"FETCH_NEW_EMAILS":try{let t=await nf(e.userEmail,e.userId,e.fullRefresh);r(t)}catch(e){console.error(" Intrackt Background: Error fetching new emails:",e),r({success:!1,error:e.message})}break;case"FETCH_QUOTA_DATA":try{let t=e.userEmail||i,s=e.userId||n;if(!t||!s)return void r({success:!1,error:"User email or ID not available for fetching quota."});let a=await nd(nh.SYNC_EMAILS,{method:"POST",body:{userEmail:t,userId:s,fetchOnlyQuota:!0}});a.success&&a.quota?(await chrome.storage.local.set({quotaData:a.quota}),r({success:!0,quota:a.quota})):r({success:!1,error:a.error||"Quota data not found in response."})}catch(e){console.error(" Intrackt Background: Error fetching quota data:",e),r({success:!1,error:e.message})}break;case"FETCH_FOLLOWUP_SUGGESTIONS":try{let t=e.userEmail||i,s=e.userId||n;if(!t||!s)return void r({success:!1,error:"User email or ID not available for follow-up suggestions."});let a=await nd(nh.FOLLOWUP_NEEDED,{method:"POST",body:{userEmail:t,userId:s}});a.success&&a.suggestions?(await chrome.storage.local.set({followUpSuggestions:a.suggestions}),r({success:!0,suggestions:a.suggestions})):r({success:!1,error:a.error||"Follow-up suggestions not found."})}catch(e){console.error(" Intrackt Background: Error fetching follow-up suggestions:",e),r({success:!1,error:e.message})}break;case"SEND_EMAIL_REPLY":try{let{threadId:t,recipient:i,subject:s,body:a,userEmail:o}=e,l=await np(t,i,s,a,o,n);await nf(o,n,!1),r({success:!0,message:"Email sent successfully!",result:l})}catch(e){console.error(" Intrackt Background: Error sending email reply:",e),r({success:!1,error:e.message})}break;case"ARCHIVE_EMAIL":try{let t=await nd(nh.ARCHIVE_EMAIL,{method:"POST",body:{threadId:e.threadId,userEmail:e.userEmail,userId:n}});t.success&&await nf(e.userEmail,n,!1),r(t)}catch(e){console.error(" Intrackt Background: Error archiving email:",e),r({success:!1,error:e.message})}break;case"REPORT_MISCLASSIFICATION":try{let n={...e.emailData,userEmail:e.emailData.userEmail||i,userId:t.userId},s=await nd(nh.REPORT_MISCLASSIFICATION,{method:"POST",body:n});s.success&&await nf(n.userEmail,n.userId,!1),r(s)}catch(e){r({success:!1,error:e.message})}break;case"UNDO_MISCLASSIFICATION":try{let n={...e.undoData,userEmail:e.userEmail||i,userId:t.userId},s=await nd(nh.UNDO_MISCLASSIFICATION,{method:"POST",body:n});s.success&&await nf(n.userEmail,n.userId,!1),r(s)}catch(e){r({success:!1,error:e.message})}break;case"MARK_AS_READ":try{let{category:t,userId:n}=e.payload,i=nu.currentUser;if(!i||i.uid!==n)return void r({success:!1,error:"Unauthorized or user mismatch for marking as read."});let s=((await chrome.storage.local.get(["appliedEmails","interviewedEmails","offersEmails","rejectedEmails","irrelevantEmails"]))[`${t}Emails`]||[]).map(e=>({...e,isRead:!0}));await chrome.storage.local.set({[`${t}Emails`]:s}),console.log(`\u{2705} Intrackt Background: Marked emails in category '${t}' as read in local storage.`),r({success:!0,message:`Emails in ${t} marked as read.`})}catch(e){console.error(" Intrackt Background: Error marking emails as read:",e),r({success:!1,error:e.message})}break;default:console.warn("Intrackt: Unhandled message type:",e.type),r({success:!1,error:"Unhandled message type."})}})(),!0)),R(nu).setPersistence(rO).then(()=>{console.log(" Intrackt Background: Firebase Auth persistence set to IndexedDB."),ru(nu,async e=>{if(e)if(console.log(" Intrackt Background: Auth State Changed - User logged in:",e.email,"UID:",e.uid),await chrome.storage.local.set({userEmail:e.email,userName:e.displayName||e.email,userId:e.uid}),e.isAnonymous)console.log("Intrackt Background: Anonymous user detected. Not fetching plan or syncing emails.");else{try{let t=await nd(nh.FETCH_USER_PLAN,{method:"POST",body:{email:e.email,userId:e.uid}});t.success?(await chrome.storage.local.set({userPlan:t.plan}),console.log(" Intrackt Background: User plan fetched and stored:",t.plan)):console.error(" Intrackt Background: Failed to fetch user plan during auth state change:",t.error)}catch(e){console.error(" Intrackt Background: Network/communication error fetching user plan during auth state change:",e)}await nf(e.email,e.uid,!1)}else console.log(" Intrackt Background: Auth State Changed - User logged out."),await chrome.storage.local.remove(["userEmail","userName","userId","userPlan","appliedEmails","interviewedEmails","offersEmails","rejectedEmails","irrelevantEmails","quotaData","followUpSuggestions"]);chrome.runtime.sendMessage({type:"AUTH_READY",success:!0,loggedOut:!e})})}).catch(e=>{console.error(" Intrackt Background: Error setting Firebase Auth persistence:",e),ru(nu,async e=>{e?(console.log("Intrackt Background: Auth State Changed (without persistence) - User logged in:",e.email),await chrome.storage.local.set({userEmail:e.email,userName:e.displayName||e.email,userId:e.uid}),e.isAnonymous||await nf(e.email,e.uid,!1)):(console.log("Intrackt Background: Auth State Changed (without persistence) - User logged out."),await chrome.storage.local.remove(["userEmail","userName","userId","userPlan","appliedEmails","interviewedEmails","offersEmails","rejectedEmails","irrelevantEmails","quotaData","followUpSuggestions"])),chrome.runtime.sendMessage({type:"AUTH_READY",success:!0,loggedOut:!e})})}),chrome.alarms.create("syncEmails",{periodInMinutes:15}),chrome.alarms.onAlarm.addListener(async e=>{if("syncEmails"===e.name){console.log(" Intrackt: Syncing emails via alarm...");let e=nu.currentUser;if(e&&!e.isAnonymous)try{let e=await chrome.storage.local.get(["userEmail","userId"]);e.userEmail&&e.userId?await nf(e.userEmail,e.userId,!1):console.warn("Intrackt: User not logged in or user info missing for alarm sync.")}catch(e){console.error(" Intrackt: Error during alarm-triggered email sync:",e),chrome.runtime.sendMessage({type:"EMAILS_SYNCED",success:!1,error:e.message})}else console.log("Intrackt: Skipping email sync for unauthenticated or anonymous user.")}})})();