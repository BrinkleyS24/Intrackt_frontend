(()=>{let e,t,r;var i,n=globalThis;let s=function(e){let t=[],r=0;for(let i=0;i<e.length;i++){let n=e.charCodeAt(i);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:((64512&n)==55296&&i+1<e.length&&(64512&e.charCodeAt(i+1))==56320?(n=65536+((1023&n)<<10)+(1023&e.charCodeAt(++i)),t[r++]=n>>18|240,t[r++]=n>>12&63|128):t[r++]=n>>12|224,t[r++]=n>>6&63|128),t[r++]=63&n|128)}return t},a=function(e){let t=[],r=0,i=0;for(;r<e.length;){let n=e[r++];if(n<128)t[i++]=String.fromCharCode(n);else if(n>191&&n<224){let s=e[r++];t[i++]=String.fromCharCode((31&n)<<6|63&s)}else if(n>239&&n<365){let s=e[r++],a=((7&n)<<18|(63&s)<<12|(63&e[r++])<<6|63&e[r++])-65536;t[i++]=String.fromCharCode(55296+(a>>10)),t[i++]=String.fromCharCode(56320+(1023&a))}else{let s=e[r++],a=e[r++];t[i++]=String.fromCharCode((15&n)<<12|(63&s)<<6|63&a)}}return t.join("")},o={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){let n=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,c=o?e[t+2]:0,l=n>>2,u=(3&n)<<4|a>>4,d=(15&a)<<2|c>>6,h=63&c;!o&&(h=64,s||(d=64)),i.push(r[l],r[u],r[d],r[h])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(s(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):a(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){let n=r[e.charAt(t++)],s=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==n||null==s||null==a||null==o)throw new c;let l=n<<2|s>>4;if(i.push(l),64!==a){let e=s<<4&240|a>>2;if(i.push(e),64!==o){let e=a<<6&192|o;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class c extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let l=function(e){let t=s(e);return o.encodeByteArray(t,!0)},u=function(e){return l(e).replace(/\./g,"")},d=function(e){try{return o.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},h=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n)return n;throw Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&d(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},p=()=>{var e;return null==(e=h())?void 0:e.config},m=e=>{var t;return null==(t=h())?void 0:t[`_${e}`]};class g{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function f(e){return e.endsWith(".cloudworkstations.dev")}async function I(e){return(await fetch(e,{credentials:"include"})).ok}let y={},E=!1;function _(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}class v extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,v.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,w.prototype.create)}}class w{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var r,i;let n=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(r=a,i=n,r.replace(b,(e,t)=>{let r=i[t];return null!=r?String(r):`<${t}?>`})):"Error",c=`${this.serviceName}: ${o} (${s}).`;return new v(s,c,n)}}let b=/\{\$([^}]+)}/g;function T(e,t){if(e===t)return!0;let r=Object.keys(e),i=Object.keys(t);for(let n of r){if(!i.includes(n))return!1;let r=e[n],s=t[n];if(A(r)&&A(s)){if(!T(r,s))return!1}else if(r!==s)return!1}for(let e of i)if(!r.includes(e))return!1;return!0}function A(e){return null!==e&&"object"==typeof e}function S(e){let t=[];for(let[r,i]of Object.entries(e))Array.isArray(i)?i.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function k(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[r,i]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(i)}}),t}function C(e){let t=e.indexOf("?");if(!t)return"";let r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}class P{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(void 0===e&&void 0===t&&void 0===r)throw Error("Missing Observer.");void 0===(i=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:r}:e).next&&(i.next=O),void 0===i.error&&(i.error=O),void 0===i.complete&&(i.complete=O);let n=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}}),this.observers.push(i),n}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function O(){}function R(e){return e&&e._delegate?e._delegate:e}class N{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let M="[DEFAULT]";class D{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new g;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!=(t=null==e?void 0:e.optional)&&t;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(e){if(i)return null;throw e}if(i)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:M})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=M){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=M){return this.instances.has(e)}getOptions(e=M){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){var r;let i=this.normalizeInstanceIdentifier(t),n=null!=(r=this.onInitCallbacks.get(i))?r:new Set;n.add(e),this.onInitCallbacks.set(i,n);let s=this.instances.get(i);return s&&e(s,i),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let i of r)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var r;let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===M?void 0:r,options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch(e){}return i||null}normalizeInstanceIdentifier(e=M){return this.component?this.component.multipleInstances?e:M:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class L{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new D(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let U=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i||(i={}));let F={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},B=i.INFO,j={[i.DEBUG]:"log",[i.VERBOSE]:"log",[i.INFO]:"info",[i.WARN]:"warn",[i.ERROR]:"error"},x=(e,t,...r)=>{if(t<e.logLevel)return;let i=new Date().toISOString(),n=j[t];if(n)console[n](`[${i}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class H{constructor(e){this.name=e,this._logLevel=B,this._logHandler=x,this._userLogHandler=null,U.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in i))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?F[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,i.DEBUG,...e),this._logHandler(this,i.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,i.VERBOSE,...e),this._logHandler(this,i.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,i.INFO,...e),this._logHandler(this,i.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,i.WARN,...e),this._logHandler(this,i.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,i.ERROR,...e),this._logHandler(this,i.ERROR,...e)}}let V=new WeakMap,W=new WeakMap,$=new WeakMap,z=new WeakMap,G=new WeakMap,q={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return W.get(e);if("objectStoreNames"===t)return e.objectStoreNames||$.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return K(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function K(r){if(r instanceof IDBRequest){let e=new Promise((e,t)=>{let i=()=>{r.removeEventListener("success",n),r.removeEventListener("error",s)},n=()=>{e(K(r.result)),i()},s=()=>{t(r.error),i()};r.addEventListener("success",n),r.addEventListener("error",s)});return e.then(e=>{e instanceof IDBCursor&&V.set(e,r)}).catch(()=>{}),G.set(e,r),e}if(z.has(r))return z.get(r);let i=function(r){if("function"==typeof r)return r!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(t||(t=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(r)?function(...e){return r.apply(J(this),e),K(V.get(this))}:function(...e){return K(r.apply(J(this),e))}:function(e,...t){let i=r.call(J(this),e,...t);return $.set(i,e.sort?e.sort():[e]),K(i)};return r instanceof IDBTransaction&&function(e){if(W.has(e))return;let t=new Promise((t,r)=>{let i=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",s),e.removeEventListener("abort",s)},n=()=>{t(),i()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",n),e.addEventListener("error",s),e.addEventListener("abort",s)});W.set(e,t)}(r),(e||(e=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>r instanceof e)?new Proxy(r,q):r}(r);return i!==r&&(z.set(r,i),G.set(i,r)),i}let J=e=>G.get(e),Y=["get","getKey","getAll","getAllKeys","count"],X=["put","add","delete","clear"],Z=new Map;function Q(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(Z.get(t))return Z.get(t);let r=t.replace(/FromIndex$/,""),i=t!==r,n=X.includes(r);if(!(r in(i?IDBIndex:IDBObjectStore).prototype)||!(n||Y.includes(r)))return;let s=async function(e,...t){let s=this.transaction(e,n?"readwrite":"readonly"),a=s.store;return i&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),n&&s.done]))[0]};return Z.set(t,s),s}q=(e=>({...e,get:(t,r,i)=>Q(t,r)||e.get(t,r,i),has:(t,r)=>!!Q(t,r)||e.has(t,r)}))(q);class ee{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!function(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let et="@firebase/app",er="0.13.1",ei=new H("@firebase/app"),en="[DEFAULT]",es={[et]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},ea=new Map,eo=new Map,ec=new Map;function el(e,t){try{e.container.addComponent(t)}catch(r){ei.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function eu(e){let t=e.name;if(ec.has(t))return ei.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(ec.set(t,e),ea.values()))el(r,e);for(let t of eo.values())el(t,e);return!0}function ed(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function eh(e){return null!=e&&void 0!==e.settings}let ep=new w("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class em{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new N("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ep.create("app-deleted",{appName:this._name})}}let eg="11.9.0";function ef(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let i=Object.assign({name:en,automaticDataCollectionEnabled:!0},t),n=i.name;if("string"!=typeof n||!n)throw ep.create("bad-app-name",{appName:String(n)});if(r||(r=p()),!r)throw ep.create("no-options");let s=ea.get(n);if(s)if(T(r,s.options)&&T(i,s.config))return s;else throw ep.create("duplicate-app",{appName:n});let a=new L(n);for(let e of ec.values())a.addComponent(e);let o=new em(r,i,a);return ea.set(n,o),o}function eI(e,t,r){var i;let n=null!=(i=es[e])?i:e;r&&(n+=`-${r}`);let s=n.match(/\s|\//),a=t.match(/\s|\//);if(s||a){let e=[`Unable to register library "${n}" with version "${t}":`];s&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),ei.warn(e.join(" "));return}eu(new N(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}let ey="firebase-heartbeat-store",eE=null;function e_(){return eE||(eE=(function(e,t,{blocked:r,upgrade:i,blocking:n,terminated:s}={}){let a=indexedDB.open(e,1),o=K(a);return i&&a.addEventListener("upgradeneeded",e=>{i(K(a.result),e.oldVersion,e.newVersion,K(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),n&&e.addEventListener("versionchange",e=>n(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(ey)}catch(e){console.warn(e)}}}).catch(e=>{throw ep.create("idb-open",{originalErrorMessage:e.message})})),eE}async function ev(e){try{let t=(await e_()).transaction(ey),r=await t.objectStore(ey).get(eb(e));return await t.done,r}catch(e){if(e instanceof v)ei.warn(e.message);else{let t=ep.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});ei.warn(t.message)}}}async function ew(e,t){try{let r=(await e_()).transaction(ey,"readwrite"),i=r.objectStore(ey);await i.put(t,eb(e)),await r.done}catch(e){if(e instanceof v)ei.warn(e.message);else{let t=ep.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});ei.warn(t.message)}}}function eb(e){return`${e.name}!${e.options.appId}`}class eT{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new eS(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{let r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=eA();if((null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(e=>e.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:r}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let i=1;i<e.length;i++)e[i].date<r&&(r=e[i].date,t=i);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ei.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=eA(),{heartbeatsToSend:r,unsentEntries:i}=function(e,t=1024){let r=[],i=e.slice();for(let n of e){let e=r.find(e=>e.agent===n.agent);if(e){if(e.dates.push(n.date),ek(r)>t){e.dates.pop();break}}else if(r.push({agent:n.agent,dates:[n.date]}),ek(r)>t){r.pop();break}i=i.slice(1)}return{heartbeatsToSend:r,unsentEntries:i}}(this._heartbeatsCache.heartbeats),n=u(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(e){return ei.warn(e),""}}}function eA(){return new Date().toISOString().substring(0,10)}class eS{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let r=!0,i="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(i);n.onsuccess=()=>{n.result.close(),r||self.indexedDB.deleteDatabase(i),e(!0)},n.onupgradeneeded=()=>{r=!1},n.onerror=()=>{var e;t((null==(e=n.error)?void 0:e.message)||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await ev(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let r=await this.read();return ew(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let r=await this.read();return ew(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}}}function ek(e){return u(JSON.stringify({version:2,heartbeats:e})).length}function eC(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,i=Object.getOwnPropertySymbols(e);n<i.length;n++)0>t.indexOf(i[n])&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]]);return r}function eP(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}eu(new N("platform-logger",e=>new ee(e),"PRIVATE")),eu(new N("heartbeat",e=>new eT(e),"PRIVATE")),eI(et,er,""),eI(et,er,"esm2017"),eI("fire-js",""),eI("firebase","11.9.1","app"),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;let eO=new w("auth","Firebase",eP()),eR=new H("@firebase/auth");function eN(e,...t){eR.logLevel<=i.ERROR&&eR.error(`Auth (${eg}): ${e}`,...t)}function eM(e,...t){throw eF(e,...t)}function eD(e,...t){return eF(e,...t)}function eL(e,t,r){return new w("auth","Firebase",Object.assign(Object.assign({},eP()),{[t]:r})).create(t,{appName:e.name})}function eU(e){return eL(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function eF(e,...t){if("string"!=typeof e){let r=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(r,...i)}return eO.create(e,...t)}function eB(e,t,...r){if(!e)throw eF(t,...r)}function ej(e){let t="INTERNAL ASSERTION FAILED: "+e;throw eN(t),Error(t)}function ex(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.href)||""}function eH(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.protocol)||null}class eV{constructor(e,t){var r;this.shortDelay=e,this.longDelay=t,r="Short delay should be less than long delay!",t>e||ej(r),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(_())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===eH()||"https:"===eH()||function(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function eW(e,t){var r,i;r=e.emulator,i="Emulator should always be set here",r||ej(i);let{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class e${static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void ej("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void ej("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void ej("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let ez={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},eG=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],eq=new eV(3e4,6e4);function eK(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function eJ(e,t,r,i,n={}){return eY(e,n,async()=>{let n={},s={};i&&("GET"===t?s=i:n={body:JSON.stringify(i)});let a=S(Object.assign({key:e.config.apiKey},s)).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);let c=Object.assign({method:t,headers:o},n);return("undefined"==typeof navigator||"Cloudflare-Workers"!==navigator.userAgent)&&(c.referrerPolicy="no-referrer"),e.emulatorConfig&&f(e.emulatorConfig.host)&&(c.credentials="include"),e$.fetch()(await eZ(e,e.config.apiHost,r,a),c)})}async function eY(e,t,r){e._canInitEmulator=!1;let i=Object.assign(Object.assign({},ez),t);try{let t=new eQ(e),n=await Promise.race([r(),t.promise]);t.clearNetworkTimeout();let s=await n.json();if("needConfirmation"in s)throw e1(e,"account-exists-with-different-credential",s);if(n.ok&&!("errorMessage"in s))return s;{let[t,r]=(n.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw e1(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw e1(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw e1(e,"user-disabled",s);let a=i[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(r)throw eL(e,a,r);eM(e,a)}}catch(t){if(t instanceof v)throw t;eM(e,"network-request-failed",{message:String(t)})}}async function eX(e,t,r,i,n={}){let s=await eJ(e,t,r,i,n);return"mfaPendingCredential"in s&&eM(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function eZ(e,t,r,i){let n=`${t}${r}?${i}`,s=e.config.emulator?eW(e.config,n):`${e.config.apiScheme}://${n}`;return eG.includes(r)&&(await e._persistenceManagerAvailable,"COOKIE"===e._getPersistenceType())?e._getPersistence()._getFinalTarget(s).toString():s}class eQ{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(eD(this.auth,"network-request-failed")),eq.get())})}}function e1(e,t,r){let i={appName:e.name};r.email&&(i.email=r.email),r.phoneNumber&&(i.phoneNumber=r.phoneNumber);let n=eD(e,t,i);return n.customData._tokenResponse=r,n}function e0(e){return void 0!==e&&void 0!==e.enterprise}class e6{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)switch(t.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function e3(e,t){return eJ(e,"GET","/v2/recaptchaConfig",eK(e,t))}async function e4(e,t){return eJ(e,"POST","/v1/accounts:delete",t)}async function e2(e,t){return eJ(e,"POST","/v1/accounts:lookup",t)}function e5(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function e8(e,t=!1){let r=R(e),i=await r.getIdToken(t),n=e9(i);eB(n&&n.exp&&n.auth_time&&n.iat,r.auth,"internal-error");let s="object"==typeof n.firebase?n.firebase:void 0,a=null==s?void 0:s.sign_in_provider;return{claims:n,token:i,authTime:e5(e7(n.auth_time)),issuedAtTime:e5(e7(n.iat)),expirationTime:e5(e7(n.exp)),signInProvider:a||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}function e7(e){return 1e3*Number(e)}function e9(e){let[t,r,i]=e.split(".");if(void 0===t||void 0===r||void 0===i)return eN("JWT malformed, contained fewer than 3 sections"),null;try{let e=d(r);if(!e)return eN("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return eN("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function te(e){let t=e9(e);return eB(t,"internal-error"),eB(void 0!==t.exp,"internal-error"),eB(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function tt(e,t,r=!1){if(r)return t;try{return await t}catch(t){throw t instanceof v&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class tr{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(!e)return this.errorBackoff=3e4,Math.max(0,(null!=(t=this.user.stsTokenManager.expirationTime)?t:0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(null==e?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class ti{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=e5(this.lastLoginAt),this.creationTime=e5(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function tn(e){var t,r,i;let n=e.auth,s=await e.getIdToken(),a=await tt(e,e2(n,{idToken:s}));eB(null==a?void 0:a.users.length,n,"internal-error");let o=a.users[0];e._notifyReloadListener(o);let c=(null==(t=o.providerUserInfo)?void 0:t.length)?ta(o.providerUserInfo):[],l=(r=e.providerData,i=c,[...r.filter(e=>!i.some(t=>t.providerId===e.providerId)),...i]),u=e.isAnonymous,d=!(e.email&&o.passwordHash)&&!(null==l?void 0:l.length);Object.assign(e,{uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:l,metadata:new ti(o.createdAt,o.lastLoginAt),isAnonymous:!!u&&d})}async function ts(e){let t=R(e);await tn(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function ta(e){return e.map(e=>{var{providerId:t}=e,r=eC(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}async function to(e,t){let r=await eY(e,{},async()=>{let r=S({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:n}=e.config,s=await eZ(e,i,"/v1/token",`key=${n}`),a=await e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";let o={method:"POST",headers:a,body:r};return e.emulatorConfig&&f(e.emulatorConfig.host)&&(o.credentials="include"),e$.fetch()(s,o)});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function tc(e,t){return eJ(e,"POST","/v2/accounts:revokeToken",eK(e,t))}class tl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){eB(e.idToken,"internal-error"),eB(void 0!==e.idToken,"internal-error"),eB(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):te(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){eB(0!==e.length,"internal-error");let t=te(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(eB(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:r,refreshToken:i,expiresIn:n}=await to(e,t);this.updateTokensAndExpiration(r,i,Number(n))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){let{refreshToken:r,accessToken:i,expirationTime:n}=t,s=new tl;return r&&(eB("string"==typeof r,"internal-error",{appName:e}),s.refreshToken=r),i&&(eB("string"==typeof i,"internal-error",{appName:e}),s.accessToken=i),n&&(eB("number"==typeof n,"internal-error",{appName:e}),s.expirationTime=n),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new tl,this.toJSON())}_performRefresh(){return ej("not implemented")}}function tu(e,t){eB("string"==typeof e||void 0===e,"internal-error",{appName:t})}class td{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,n=eC(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new tr(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=n.displayName||null,this.email=n.email||null,this.emailVerified=n.emailVerified||!1,this.phoneNumber=n.phoneNumber||null,this.photoURL=n.photoURL||null,this.isAnonymous=n.isAnonymous||!1,this.tenantId=n.tenantId||null,this.providerData=n.providerData?[...n.providerData]:[],this.metadata=new ti(n.createdAt||void 0,n.lastLoginAt||void 0)}async getIdToken(e){let t=await tt(this,this.stsTokenManager.getToken(this.auth,e));return eB(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return e8(this,e)}reload(){return ts(this)}_assign(e){this!==e&&(eB(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new td(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){eB(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await tn(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(eh(this.auth.app))return Promise.reject(eU(this.auth));let e=await this.getIdToken();return await tt(this,e4(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,n,s,a,o,c,l;let u=null!=(r=t.displayName)?r:void 0,d=null!=(i=t.email)?i:void 0,h=null!=(n=t.phoneNumber)?n:void 0,p=null!=(s=t.photoURL)?s:void 0,m=null!=(a=t.tenantId)?a:void 0,g=null!=(o=t._redirectEventId)?o:void 0,f=null!=(c=t.createdAt)?c:void 0,I=null!=(l=t.lastLoginAt)?l:void 0,{uid:y,emailVerified:E,isAnonymous:_,providerData:v,stsTokenManager:w}=t;eB(y&&w,e,"internal-error");let b=tl.fromJSON(this.name,w);eB("string"==typeof y,e,"internal-error"),tu(u,e.name),tu(d,e.name),eB("boolean"==typeof E,e,"internal-error"),eB("boolean"==typeof _,e,"internal-error"),tu(h,e.name),tu(p,e.name),tu(m,e.name),tu(g,e.name),tu(f,e.name),tu(I,e.name);let T=new td({uid:y,auth:e,email:d,emailVerified:E,displayName:u,isAnonymous:_,photoURL:p,phoneNumber:h,tenantId:m,stsTokenManager:b,createdAt:f,lastLoginAt:I});return v&&Array.isArray(v)&&(T.providerData=v.map(e=>Object.assign({},e))),g&&(T._redirectEventId=g),T}static async _fromIdTokenResponse(e,t,r=!1){let i=new tl;i.updateFromServerResponse(t);let n=new td({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await tn(n),n}static async _fromGetAccountInfoResponse(e,t,r){let i=t.users[0];eB(void 0!==i.localId,"internal-error");let n=void 0!==i.providerUserInfo?ta(i.providerUserInfo):[],s=!(i.email&&i.passwordHash)&&!(null==n?void 0:n.length),a=new tl;a.updateFromIdToken(r);let o=new td({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:s});return Object.assign(o,{uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:n,metadata:new ti(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(null==n?void 0:n.length)}),o}}let th=new Map;function tp(e){var t,r;t="Expected a class definition",e instanceof Function||ej(t);let i=th.get(e);return i?(r="Instance stored in cache mismatched with class",i instanceof e||ej(r)):(i=new e,th.set(e,i)),i}class tm{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function tg(e,t,r){return`firebase:${e}:${t}:${r}`}tm.type="NONE";class tf{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:i,name:n}=this.auth;this.fullUserKey=tg(this.userKey,i.apiKey,n),this.fullPersistenceKey=tg("persistence",i.apiKey,n),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await e2(this.auth,{idToken:e}).catch(()=>void 0);return t?td._fromGetAccountInfoResponse(this.auth,t,e):null}return td._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new tf(tp(tm),e,r);let i=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),n=i[0]||tp(tm),s=tg(r,e.config.apiKey,e.name),a=null;for(let r of t)try{let t=await r._get(s);if(t){let i;if("string"==typeof t){let r=await e2(e,{idToken:t}).catch(()=>void 0);if(!r)break;i=await td._fromGetAccountInfoResponse(e,r,t)}else i=td._fromJSON(e,t);r!==n&&(a=i),n=r;break}}catch(e){}let o=i.filter(e=>e._shouldAllowMigration);return n._shouldAllowMigration&&o.length&&(n=o[0],a&&await n._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==n)try{await e._remove(s)}catch(e){}}))),new tf(n,e,r)}}function tI(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(tv(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(ty(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(tb(t))return"Blackberry";if(tT(t))return"Webos";if(tE(t))return"Safari";if((t.includes("chrome/")||t_(t))&&!t.includes("edge/"))return"Chrome";if(tw(t))return"Android";let r=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if((null==r?void 0:r.length)===2)return r[1]}return"Other"}function ty(e=_()){return/firefox\//i.test(e)}function tE(e=_()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function t_(e=_()){return/crios\//i.test(e)}function tv(e=_()){return/iemobile/i.test(e)}function tw(e=_()){return/android/i.test(e)}function tb(e=_()){return/blackberry/i.test(e)}function tT(e=_()){return/webos/i.test(e)}function tA(e=_()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function tS(e=_()){return tA(e)||tw(e)||tT(e)||tb(e)||/windows phone/i.test(e)||tv(e)}function tk(e,t=[]){let r;switch(e){case"Browser":r=tI(_());break;case"Worker":r=`${tI(_())}-${e}`;break;default:r=e}let i=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${eg}/${i}`}class tC{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=t=>new Promise((r,i)=>{try{let i=e(t);r(i)}catch(e){i(e)}});r.onAbort=t,this.queue.push(r);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}async function tP(e,t={}){return eJ(e,"GET","/v2/passwordPolicy",eK(e,t))}class tO{constructor(e){var t,r,i,n;let s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!=(t=s.minPasswordLength)?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!=(i=null==(r=e.allowedNonAlphanumericCharacters)?void 0:r.join(""))?i:"",this.forceUpgradeOnSignin=null!=(n=e.forceUpgradeOnSignin)&&n,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,n,s,a;let o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null==(t=o.meetsMinPasswordLength)||t),o.isValid&&(o.isValid=null==(r=o.meetsMaxPasswordLength)||r),o.isValid&&(o.isValid=null==(i=o.containsLowercaseLetter)||i),o.isValid&&(o.isValid=null==(n=o.containsUppercaseLetter)||n),o.isValid&&(o.isValid=null==(s=o.containsNumericCharacter)||s),o.isValid&&(o.isValid=null==(a=o.containsNonAlphanumericCharacter)||a),o}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){let r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,n){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=n))}}class tR{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new tN(this),this.idTokenSubscription=new tN(this),this.beforeStateQueue=new tC(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=eO,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=tp(t)),this._initializationPromise=this.queue(async()=>{var r,i,n;if(!this._deleted){if(this.persistenceManager=await tf.create(this,e),null==(r=this._resolvePersistenceManagerAvailable)||r.call(this),!this._deleted){if(null==(i=this._popupRedirectResolver)?void 0:i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null==(n=this.currentUser)?void 0:n.uid)||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await e2(this,{idToken:e}),r=await td._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(eh(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let r=await this.assertedPersistence.getCurrentUser(),i=r,n=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let r=null==(t=this.redirectUser)?void 0:t._redirectEventId,s=null==i?void 0:i._redirectEventId,a=await this.tryRedirectSignIn(e);(!r||r===s)&&(null==a?void 0:a.user)&&(i=a.user,n=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(n)try{await this.beforeStateQueue.runMiddleware(i)}catch(e){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return(eB(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId)?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await tn(e)}catch(e){if((null==e?void 0:e.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(eh(this.app))return Promise.reject(eU(this));let t=e?R(e):null;return t&&eB(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&eB(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return eh(this.app)?Promise.reject(eU(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return eh(this.app)?Promise.reject(eU(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(tp(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new tO(await tP(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new w("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await tc(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null==(e=this._currentUser)?void 0:e.toJSON()}}async _setRedirectUser(e,t){let r=await this.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&tp(e)||this._popupRedirectResolver;eB(t,this,"argument-error"),this.redirectPersistenceManager=await tf.create(this,[tp(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return(this._isInitialized&&await this.queue(async()=>{}),(null==(t=this._currentUser)?void 0:t._redirectEventId)===e)?this._currentUser:(null==(r=this.redirectUser)?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=null!=(t=null==(e=this.currentUser)?void 0:e.uid)?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};let n="function"==typeof t?t:t.next.bind(t),s=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(eB(a,this,"internal-error"),a.then(()=>{s||n(this.currentUser)}),"function"==typeof t){let n=e.addObserver(t,r,i);return()=>{s=!0,n()}}{let r=e.addObserver(t);return()=>{s=!0,r()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return eB(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=tk(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=await (null==(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);let i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;if(eh(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=await (null==(e=this.appCheckServiceProvider.getImmediate({optional:!0}))?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){eR.logLevel<=i.WARN&&eR.warn(`Auth (${eg}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}class tN{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){let r=new P(e,void 0);return r.subscribe.bind(r)}(e=>this.observer=e)}get next(){return eB(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let tM={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function tD(e){return`__${e}${Math.floor(1e6*Math.random())}`}class tL{constructor(){this.enterprise=new tU}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class tU{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let tF="NO_RECAPTCHA";class tB{constructor(e){this.type="recaptcha-enterprise",this.auth=R(e)}async verify(e="verify",t=!1){async function r(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,r)=>{e3(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(i=>{if(void 0===i.recaptchaKey)r(Error("recaptcha Enterprise site key undefined"));else{let r=new e6(i);return null==e.tenantId?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,t(r.siteKey)}}).catch(e=>{r(e)})})}function i(t,r,i){let n=window.grecaptcha;e0(n)?n.enterprise.ready(()=>{n.enterprise.execute(t,{action:e}).then(e=>{r(e)}).catch(()=>{r(tF)})}):i(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new tL().execute("siteKey",{action:"verify"}):new Promise((e,n)=>{r(this.auth).then(r=>{if(!t&&e0(window.grecaptcha))i(r,e,n);else{var s;if("undefined"==typeof window)return void n(Error("RecaptchaVerifier is only supported in browser"));let t=tM.recaptchaEnterpriseScript;0!==t.length&&(t+=r),(s=t,tM.loadJS(s)).then(()=>{i(r,e,n)}).catch(e=>{n(e)})}}).catch(e=>{n(e)})})}}async function tj(e,t,r,i=!1,n=!1){let s,a=new tB(e);if(n)s=tF;else try{s=await a.verify(r)}catch(e){s=await a.verify(r,!0)}let o=Object.assign({},t);if("mfaSmsEnrollment"===r||"mfaSmsSignIn"===r){if("phoneEnrollmentInfo"in o){let e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){let e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return i?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function tx(e,t,r,i,n){var s,a;if("EMAIL_PASSWORD_PROVIDER"===n)if(null==(s=e._getRecaptchaConfig())||!s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return i(e,t).catch(async n=>{if("auth/missing-recaptcha-token"!==n.code)return Promise.reject(n);{console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let n=await tj(e,t,r,"getOobCode"===r);return i(e,n)}});else{let n=await tj(e,t,r,"getOobCode"===r);return i(e,n)}if("PHONE_PROVIDER"!==n)return Promise.reject(n+" provider is not supported.");if(null==(a=e._getRecaptchaConfig())?void 0:a.isProviderEnabled("PHONE_PROVIDER")){let n=await tj(e,t,r);return i(e,n).catch(async n=>{var s;if((null==(s=e._getRecaptchaConfig())?void 0:s.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&("auth/missing-recaptcha-token"===n.code||"auth/invalid-app-credential"===n.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${r} flow.`);let n=await tj(e,t,r,!1,!0);return i(e,n)}return Promise.reject(n)})}{let n=await tj(e,t,r,!1,!0);return i(e,n)}}async function tH(e){let t=R(e),r=new e6(await e3(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=r:t._tenantRecaptchaConfigs[t.tenantId]=r,r.isAnyProviderEnabled()&&new tB(t).verify()}function tV(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function tW(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class t${constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ej("not implemented")}_getIdTokenResponse(e){return ej("not implemented")}_linkToIdToken(e,t){return ej("not implemented")}_getReauthenticationResolver(e){return ej("not implemented")}}async function tz(e,t){return eJ(e,"POST","/v1/accounts:signUp",t)}async function tG(e,t){return eX(e,"POST","/v1/accounts:signInWithPassword",eK(e,t))}async function tq(e,t){return eX(e,"POST","/v1/accounts:signInWithEmailLink",eK(e,t))}async function tK(e,t){return eX(e,"POST","/v1/accounts:signInWithEmailLink",eK(e,t))}class tJ extends t${constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new tJ(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new tJ(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return tx(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",tG,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return tq(e,{email:this._email,oobCode:this._password});default:eM(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return tx(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",tz,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return tK(e,{idToken:t,email:this._email,oobCode:this._password});default:eM(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function tY(e,t){return eX(e,"POST","/v1/accounts:signInWithIdp",eK(e,t))}class tX extends t${constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new tX(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):eM("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e,{providerId:r,signInMethod:i}=t,n=eC(t,["providerId","signInMethod"]);if(!r||!i)return null;let s=new tX(r,i);return s.idToken=n.idToken||void 0,s.accessToken=n.accessToken||void 0,s.secret=n.secret,s.nonce=n.nonce,s.pendingToken=n.pendingToken||null,s}_getIdTokenResponse(e){return tY(e,this.buildRequest())}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,tY(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,tY(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=S(t)}return e}}async function tZ(e,t){return eJ(e,"POST","/v1/accounts:sendVerificationCode",eK(e,t))}async function tQ(e,t){return eX(e,"POST","/v1/accounts:signInWithPhoneNumber",eK(e,t))}async function t1(e,t){let r=await eX(e,"POST","/v1/accounts:signInWithPhoneNumber",eK(e,t));if(r.temporaryProof)throw e1(e,"account-exists-with-different-credential",r);return r}let t0={USER_NOT_FOUND:"user-not-found"};async function t6(e,t){return eX(e,"POST","/v1/accounts:signInWithPhoneNumber",eK(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),t0)}class t3 extends t${constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new t3({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new t3({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return tQ(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return t1(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return t6(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:i}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:n}=e;return r||t||i||n?new t3({verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:n}):null}}class t4{constructor(e){var t,r,i,n,s,a;let o=k(C(e)),c=null!=(t=o.apiKey)?t:null,l=null!=(r=o.oobCode)?r:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!=(i=o.mode)?i:null);eB(c&&l&&u,"argument-error"),this.apiKey=c,this.operation=u,this.code=l,this.continueUrl=null!=(n=o.continueUrl)?n:null,this.languageCode=null!=(s=o.lang)?s:null,this.tenantId=null!=(a=o.tenantId)?a:null}static parseLink(e){let t=function(e){let t=k(C(e)).link,r=t?k(C(t)).deep_link_id:null,i=k(C(e)).deep_link_id;return(i?k(C(i)).link:null)||i||r||t||e}(e);try{return new t4(t)}catch(e){return null}}}class t2{constructor(){this.providerId=t2.PROVIDER_ID}static credential(e,t){return tJ._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let r=t4.parseLink(t);return eB(r,"argument-error"),tJ._fromEmailAndCode(e,r.code,r.tenantId)}}t2.PROVIDER_ID="password",t2.EMAIL_PASSWORD_SIGN_IN_METHOD="password",t2.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class t5{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class t8 extends t5{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class t7 extends t8{constructor(){super("facebook.com")}static credential(e){return tX._fromParams({providerId:t7.PROVIDER_ID,signInMethod:t7.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return t7.credentialFromTaggedObject(e)}static credentialFromError(e){return t7.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return t7.credential(e.oauthAccessToken)}catch(e){return null}}}t7.FACEBOOK_SIGN_IN_METHOD="facebook.com",t7.PROVIDER_ID="facebook.com";class t9 extends t8{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return tX._fromParams({providerId:t9.PROVIDER_ID,signInMethod:t9.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return t9.credentialFromTaggedObject(e)}static credentialFromError(e){return t9.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return t9.credential(t,r)}catch(e){return null}}}t9.GOOGLE_SIGN_IN_METHOD="google.com",t9.PROVIDER_ID="google.com";class re extends t8{constructor(){super("github.com")}static credential(e){return tX._fromParams({providerId:re.PROVIDER_ID,signInMethod:re.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return re.credentialFromTaggedObject(e)}static credentialFromError(e){return re.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return re.credential(e.oauthAccessToken)}catch(e){return null}}}re.GITHUB_SIGN_IN_METHOD="github.com",re.PROVIDER_ID="github.com";class rt extends t8{constructor(){super("twitter.com")}static credential(e,t){return tX._fromParams({providerId:rt.PROVIDER_ID,signInMethod:rt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return rt.credentialFromTaggedObject(e)}static credentialFromError(e){return rt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return rt.credential(t,r)}catch(e){return null}}}rt.TWITTER_SIGN_IN_METHOD="twitter.com",rt.PROVIDER_ID="twitter.com";class rr{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,i=!1){return new rr({user:await td._fromIdTokenResponse(e,r,i),providerId:ri(r),_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){return await e._updateTokensIfNecessary(r,!0),new rr({user:e,providerId:ri(r),_tokenResponse:r,operationType:t})}}function ri(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class rn extends v{constructor(e,t,r,i){var n;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,rn.prototype),this.customData={appName:e.name,tenantId:null!=(n=e.tenantId)?n:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new rn(e,t,r,i)}}function rs(e,t,r,i){return("reauthenticate"===t?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(r=>{if("auth/multi-factor-auth-required"===r.code)throw rn._fromErrorAndOperation(e,r,t,i);throw r})}async function ra(e,t,r=!1){let i=await tt(e,t._linkToIdToken(e.auth,await e.getIdToken()),r);return rr._forOperation(e,"link",i)}async function ro(e,t,r=!1){let{auth:i}=e;if(eh(i.app))return Promise.reject(eU(i));let n="reauthenticate";try{let s=await tt(e,rs(i,n,t,e),r);eB(s.idToken,i,"internal-error");let a=e9(s.idToken);eB(a,i,"internal-error");let{sub:o}=a;return eB(e.uid===o,i,"user-mismatch"),rr._forOperation(e,n,s)}catch(e){throw(null==e?void 0:e.code)==="auth/user-not-found"&&eM(i,"user-mismatch"),e}}async function rc(e,t,r=!1){if(eh(e.app))return Promise.reject(eU(e));let i="signIn",n=await rs(e,i,t),s=await rr._fromIdTokenResponse(e,i,n);return r||await e._updateCurrentUser(s.user),s}async function rl(e,t){return eX(e,"POST","/v1/accounts:signInWithCustomToken",eK(e,t))}async function ru(e,t){if(eh(e.app))return Promise.reject(eU(e));let r=R(e),i=await rl(r,{token:t,returnSecureToken:!0}),n=await rr._fromIdTokenResponse(r,"signIn",i);return await r._updateCurrentUser(n.user),n}function rd(e,t,r,i){return R(e).onAuthStateChanged(t,r,i)}function rh(e){return R(e).signOut()}function rp(e,t){return eJ(e,"POST","/v2/accounts/mfaEnrollment:start",eK(e,t))}new WeakMap;let rm="__sak";class rg{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(rm,"1"),this.storage.removeItem(rm),Promise.resolve(!0)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class rf extends rg{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=tS(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let r=this.storage.getItem(t),i=this.localCache[t];r!==i&&e(t,i,r)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,r)=>{this.notifyListeners(e,r)});let r=e.key;t?this.detachListener():this.stopPolling();let i=()=>{let e=this.storage.getItem(r);(t||this.localCache[r]!==e)&&this.notifyListeners(r,e)},n=this.storage.getItem(r);(function(){let e=_();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0})()&&10===document.documentMode&&n!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let e of Array.from(r))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}rf.type="LOCAL";class rI extends rg{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}rI.type="SESSION";class ry{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let r=new ry(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:r,data:i}=e.data,n=this.handlersMap[r];if(!(null==n?void 0:n.size))return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:r});let s=Array.from(n).map(async t=>t(e.origin,i)),a=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function rE(e="",t=10){let r="";for(let e=0;e<t;e++)r+=Math.floor(10*Math.random());return e+r}ry.receivers=[];class r_{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){let i,n,s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((a,o)=>{let c=rE("",20);s.port1.start();let l=setTimeout(()=>{o(Error("unsupported_event"))},r);n={messageChannel:s,onMessage(e){if(e.data.eventId===c)switch(e.data.status){case"ack":clearTimeout(l),i=setTimeout(()=>{o(Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(e.data.response);break;default:clearTimeout(l),clearTimeout(i),o(Error("invalid_response"))}}},this.handlers.add(n),s.port1.addEventListener("message",n.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[s.port2])}).finally(()=>{n&&this.removeMessageHandler(n)})}}function rv(){return window}function rw(){return void 0!==rv().WorkerGlobalScope&&"function"==typeof rv().importScripts}async function rb(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}let rT="firebaseLocalStorageDb",rA="firebaseLocalStorage",rS="fbase_key";class rk{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function rC(e,t){return e.transaction([rA],t?"readwrite":"readonly").objectStore(rA)}function rP(){let e=indexedDB.open(rT,1);return new Promise((t,r)=>{e.addEventListener("error",()=>{r(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(rA,{keyPath:rS})}catch(e){r(e)}}),e.addEventListener("success",async()=>{let r=e.result;r.objectStoreNames.contains(rA)?t(r):(r.close(),await new rk(indexedDB.deleteDatabase(rT)).toPromise(),t(await rP()))})})}async function rO(e,t,r){return new rk(rC(e,!0).put({[rS]:t,value:r})).toPromise()}async function rR(e,t){let r=rC(e,!1).get(t),i=await new rk(r).toPromise();return void 0===i?null:i.value}function rN(e,t){return new rk(rC(e,!0).delete(t)).toPromise()}class rM{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await rP()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return rw()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ry._getInstance(rw()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await rb(),!this.activeServiceWorker)return;this.sender=new r_(this.activeServiceWorker);let r=await this.sender._send("ping",{},800);r&&(null==(e=r[0])?void 0:e.fulfilled)&&(null==(t=r[0])?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null==(t=null==navigator?void 0:navigator.serviceWorker)?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await rP();return await rO(e,rm,"1"),await rN(e,rm),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>rO(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>rR(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>rN(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new rk(rC(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],r=new Set;if(0!==e.length)for(let{fbase_key:i,value:n}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(n)&&(this.notifyListeners(i,n),t.push(i));for(let e of Object.keys(this.localCache))this.localCache[e]&&!r.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let r=this.listeners[e];if(r)for(let e of Array.from(r))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function rD(e,t){return eJ(e,"POST","/v2/accounts/mfaSignIn:start",eK(e,t))}rM.type="LOCAL",tD("rcb"),new eV(3e4,6e4);let rL="recaptcha";async function rU(e,t,r){var i;if(!e._getRecaptchaConfig())try{await tH(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let n;if(n="string"==typeof t?{phoneNumber:t}:t,"session"in n){let t=n.session;if("phoneNumber"in n){eB("enroll"===t.type,e,"internal-error");let i={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:n.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===tF){eB((null==r?void 0:r.type)===rL,e,"argument-error");let i=await rF(e,t,r);return rp(e,i)}return rp(e,t)},a=tx(e,i,"mfaSmsEnrollment",s,"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{eB("signin"===t.type,e,"internal-error");let s=(null==(i=n.multiFactorHint)?void 0:i.uid)||n.multiFactorUid;eB(s,e,"missing-multi-factor-info");let a={mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},o=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===tF){eB((null==r?void 0:r.type)===rL,e,"argument-error");let i=await rF(e,t,r);return rD(e,i)}return rD(e,t)},c=tx(e,a,"mfaSmsSignIn",o,"PHONE_PROVIDER");return(await c.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:n.phoneNumber,clientType:"CLIENT_TYPE_WEB"},i=async(e,t)=>{if(t.captchaResponse===tF){eB((null==r?void 0:r.type)===rL,e,"argument-error");let i=await rF(e,t,r);return tZ(e,i)}return tZ(e,t)},s=tx(e,t,"sendVerificationCode",i,"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).sessionInfo}}finally{null==r||r._reset()}}async function rF(e,t,r){eB(r.type===rL,e,"argument-error");let i=await r.verify();eB("string"==typeof i,e,"argument-error");let n=Object.assign({},t);if("phoneEnrollmentInfo"in n){let e=n.phoneEnrollmentInfo.phoneNumber,t=n.phoneEnrollmentInfo.captchaResponse,r=n.phoneEnrollmentInfo.clientType,s=n.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(n,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:i,captchaResponse:t,clientType:r,recaptchaVersion:s}}),n}if(!("phoneSignInInfo"in n))return Object.assign(n,{recaptchaToken:i}),n;{let e=n.phoneSignInInfo.captchaResponse,t=n.phoneSignInInfo.clientType,r=n.phoneSignInInfo.recaptchaVersion;return Object.assign(n,{phoneSignInInfo:{recaptchaToken:i,captchaResponse:e,clientType:t,recaptchaVersion:r}}),n}}class rB{constructor(e){this.providerId=rB.PROVIDER_ID,this.auth=R(e)}verifyPhoneNumber(e,t){return rU(this.auth,e,R(t))}static credential(e,t){return t3._fromVerification(e,t)}static credentialFromResult(e){return rB.credentialFromTaggedObject(e)}static credentialFromError(e){return rB.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:r}=e;return t&&r?t3._fromTokenResponse(t,r):null}}rB.PROVIDER_ID="phone",rB.PHONE_SIGN_IN_METHOD="phone";class rj extends t${constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return tY(e,this._buildIdpRequest())}_linkToIdToken(e,t){return tY(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return tY(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function rx(e){return rc(e.auth,new rj(e),e.bypassAuthState)}function rH(e){let{auth:t,user:r}=e;return eB(r,t,"internal-error"),ro(r,new rj(e),e.bypassAuthState)}async function rV(e){let{auth:t,user:r}=e;return eB(r,t,"internal-error"),ra(r,new rj(e),e.bypassAuthState)}class rW{constructor(e,t,r,i,n=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=n,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:r,postBody:i,tenantId:n,error:s,type:a}=e;if(s)return void this.reject(s);let o={auth:this.auth,requestUri:t,sessionId:r,tenantId:n||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return rx;case"linkViaPopup":case"linkViaRedirect":return rV;case"reauthViaPopup":case"reauthViaRedirect":return rH;default:eM(this.auth,"internal-error")}}resolve(e){var t,r;t=this.pendingPromise,r="Pending promise was never set",t||ej(r),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,r;t=this.pendingPromise,r="Pending promise was never set",t||ej(r),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let r$=new eV(2e3,1e4);class rz extends rW{constructor(e,t,r,i,n){super(e,t,i,n),this.provider=r,this.authWindow=null,this.pollId=null,rz.currentPopupAction&&rz.currentPopupAction.cancel(),rz.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return eB(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||ej(t);let r=rE();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],r),this.authWindow.associatedEvent=r,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(eD(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null==(e=this.authWindow)?void 0:e.associatedEvent)||null}cancel(){this.reject(eD(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,rz.currentPopupAction=null}pollUserCancellation(){let e=()=>{var t,r;if(null==(r=null==(t=this.authWindow)?void 0:t.window)?void 0:r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(eD(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,r$.get())};e()}}rz.currentPopupAction=null;let rG=new Map;class rq extends rW{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=rG.get(this.auth._key());if(!e){try{let t=await rK(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}rG.set(this.auth._key(),e)}return this.bypassAuthState||rG.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function rK(e,t){var r;let i=tg("pendingRedirect",(r=t).config.apiKey,r.name),n=tp(e._redirectPersistence);if(!await n._isAvailable())return!1;let s=await n._get(i)==="true";return await n._remove(i),s}function rJ(e,t){rG.set(e._key(),t)}async function rY(e,t,r=!1){if(eh(e.app))return Promise.reject(eU(e));let i=R(e),n=t?tp(t):(eB(i._popupRedirectResolver,i,"argument-error"),i._popupRedirectResolver),s=new rq(i,n,r),a=await s.execute();return a&&!r&&(delete a.user._redirectEventId,await i._persistUserIfCurrent(a.user),await i._setRedirectUser(null,t)),a}class rX{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return rQ(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!rQ(e)){let i=(null==(r=e.error.code)?void 0:r.split("auth/")[1])||"internal-error";t.onError(eD(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let r=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(rZ(e))}saveEventToCache(e){this.cachedEventUids.add(rZ(e)),this.lastProcessedEventTime=Date.now()}}function rZ(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function rQ({type:e,error:t}){return"unknown"===e&&(null==t?void 0:t.code)==="auth/no-auth-event"}async function r1(e,t={}){return eJ(e,"GET","/v1/projects",t)}let r0=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,r6=/^https?/;async function r3(e){if(e.config.emulator)return;let{authorizedDomains:t}=await r1(e);for(let e of t)try{if(function(e){let t=ex(),{protocol:r,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){let n=new URL(e);return""===n.hostname&&""===i?"chrome-extension:"===r&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===r&&n.hostname===i}if(!r6.test(r))return!1;if(r0.test(e))return i===e;let n=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+n+"|"+n+")$","i").test(i)}(e))return}catch(e){}eM(e,"unauthorized-domain")}let r4=new eV(3e4,6e4);function r2(){let e=rv().___jsl;if(null==e?void 0:e.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let r5=null,r8=new eV(5e3,15e3),r7={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},r9=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function ie(e){let t=await (r5=r5||new Promise((t,r)=>{var i,n,s,a;function o(){r2(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{r2(),r(eD(e,"network-request-failed"))},timeout:r4.get()})}if(null==(n=null==(i=rv().gapi)?void 0:i.iframes)?void 0:n.Iframe)t(gapi.iframes.getContext());else if(null==(s=rv().gapi)?void 0:s.load)o();else{let t=tD("iframefcb");return rv()[t]=()=>{gapi.load?o():r(eD(e,"network-request-failed"))},(a=`${tM.gapiScript}?onload=${t}`,tM.loadJS(a)).catch(e=>r(e))}}).catch(e=>{throw r5=null,e})),r=rv().gapi;return eB(r,e,"internal-error"),t.open({where:document.body,url:function(e){let t=e.config;eB(t.authDomain,e,"auth-domain-config-required");let r=t.emulator?eW(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,i={apiKey:t.apiKey,appName:e.name,v:eg},n=r9.get(e.config.apiHost);n&&(i.eid=n);let s=e._getFrameworks();return s.length&&(i.fw=s.join(",")),`${r}?${S(i).slice(1)}`}(e),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:r7,dontclear:!0},t=>new Promise(async(r,i)=>{await t.restyle({setHideOnLeave:!1});let n=eD(e,"network-request-failed"),s=rv().setTimeout(()=>{i(n)},r8.get());function a(){rv().clearTimeout(s),r(t)}t.ping(a).then(a,()=>{i(n)})}))}let it={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class ir{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let ii=encodeURIComponent("fac");async function is(e,t,r,i,n,s){eB(e.config.authDomain,e,"auth-domain-config-required"),eB(e.config.apiKey,e,"invalid-api-key");let a={apiKey:e.config.apiKey,appName:e.name,authType:r,redirectUrl:i,v:eg,eventId:n};if(t instanceof t5)for(let[r,i]of(t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",!function(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())&&(a.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(s||{})))a[r]=i;if(t instanceof t8){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(a.scopes=e.join(","))}for(let t of(e.tenantId&&(a.tid=e.tenantId),Object.keys(a)))void 0===a[t]&&delete a[t];let o=await e._getAppCheckToken(),c=o?`#${ii}=${encodeURIComponent(o)}`:"";return`${function({config:e}){return e.emulator?eW(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${S(a).slice(1)}${c}`}let ia="webStorageSupport",io=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=rI,this._completeRedirectFn=rY,this._overrideRedirectResult=rJ}async _openPopup(e,t,r,i){var n,s,a;s=null==(n=this.eventManagers[e._key()])?void 0:n.manager,a="_initialize() not called before _openPopup()",s||ej(a);let o=await is(e,t,r,ex(),i);return function(e,t,r,i=500,n=600){let s=Math.max((window.screen.availHeight-n)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString(),o="",c=Object.assign(Object.assign({},it),{width:i.toString(),height:n.toString(),top:s,left:a}),l=_().toLowerCase();r&&(o=t_(l)?"_blank":r),ty(l)&&(t=t||"http://localhost",c.scrollbars="yes");let u=Object.entries(c).reduce((e,[t,r])=>`${e}${t}=${r},`,"");if(function(e=_()){var t;return tA(e)&&!!(null==(t=window.navigator)?void 0:t.standalone)}(l)&&"_self"!==o)return function(e,t){let r=document.createElement("a");r.href=e,r.target=t;let i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(i)}(t||"",o),new ir(null);let d=window.open(t||"",o,u);eB(d,e,"popup-blocked");try{d.focus()}catch(e){}return new ir(d)}(e,o,rE())}async _openRedirect(e,t,r,i){var n;return await this._originValidation(e),n=await is(e,t,r,ex(),i),rv().location.href=n,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var r;let{manager:e,promise:i}=this.eventManagers[t];return e?Promise.resolve(e):(r="If manager is not set, promise should be",i||ej(r),i)}let i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){let t=await ie(e),r=new rX(e);return t.register("authEvent",t=>(eB(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:r.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(ia,{type:ia},r=>{var i;let n=null==(i=null==r?void 0:r[0])?void 0:i[ia];void 0!==n&&t(!!n),eM(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=r3(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return tS()||tE()||tA()}};var ic="@firebase/auth",il="1.10.7";class iu{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null==(e=this.auth.currentUser)?void 0:e.uid)||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){eB(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let id=m("authIdTokenMaxAge")||300,ih=null;tM={loadJS:e=>new Promise((t,r)=>{let i=document.createElement("script");i.setAttribute("src",e),i.onload=t,i.onerror=e=>{let t=eD("internal-error");t.customData=e,r(t)},i.type="text/javascript",i.charset="UTF-8",(function(){var e,t;return null!=(t=null==(e=document.getElementsByTagName("head"))?void 0:e[0])?t:document})().appendChild(i)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},function(e){eu(new N("auth",(t,{options:r})=>{let i=t.getProvider("app").getImmediate(),n=t.getProvider("heartbeat"),s=t.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=i.options;eB(a&&!a.includes(":"),"invalid-api-key",{appName:i.name});let c=new tR(i,n,s,{apiKey:a,authDomain:o,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:tk(e)}),l=(null==r?void 0:r.persistence)||[],u=(Array.isArray(l)?l:[l]).map(tp);return(null==r?void 0:r.errorMap)&&c._updateErrorMap(r.errorMap),c._initializeWithPersistence(u,null==r?void 0:r.popupRedirectResolver),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),eu(new N("auth-internal",e=>new iu(R(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),eI(ic,il,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(e)),eI(ic,il,"esm2017")}("Browser");let ip=function(e=function(e=en){let t=ea.get(e);if(!t&&e===en&&p())return ef();if(!t)throw ep.create("no-app",{appName:e});return t}()){var t,r;let i=ed(e,"auth");if(i.isInitialized())return i.getImmediate();let n=function(e,t){let r=ed(e,"auth");if(r.isInitialized()){let e=r.getImmediate();if(T(r.getOptions(),null!=t?t:{}))return e;eM(e,"already-initialized")}return r.initialize({options:t})}(e,{popupRedirectResolver:io,persistence:[rM,rf,rI]}),s=m("authTokenSyncURL");if(s&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(s,location.origin);if(location.origin===e.origin){let t,r=(t=e.toString(),async e=>{let r=e&&await e.getIdTokenResult(),i=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(i&&i>id)return;let n=null==r?void 0:r.token;ih!==n&&(ih=n,await fetch(t,{method:n?"POST":"DELETE",headers:n?{Authorization:`Bearer ${n}`}:{}}))});R(n).beforeAuthStateChanged(r,()=>r(n.currentUser)),R(n).onIdTokenChanged(e=>r(e),void 0,void 0)}}let a=null==(r=null==(t=h())?void 0:t.emulatorHosts)?void 0:r.auth;return a&&function(e,t,r){let i=R(e);eB(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");let n=tV(t),{host:s,port:a}=function(e){let t=tV(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};let i=r[2].split("@").pop()||"",n=/^(\[[^\]]+\])(:|$)/.exec(i);if(n){let e=n[1];return{host:e,port:tW(i.substr(e.length+1))}}{let[e,t]=i.split(":");return{host:e,port:tW(t)}}}(t),o=null===a?"":`:${a}`,c={url:`${n}//${s}${o}/`},l=Object.freeze({host:s,port:a,protocol:n.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!i._canInitEmulator){eB(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),eB(T(c,i.config.emulator)&&T(l,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=c,i.emulatorConfig=l,i.settings.appVerificationDisabledForTesting=!0,f(s)?(I(`${n}//${s}${o}`),function(e,t){if("undefined"==typeof window||"undefined"==typeof document||!f(window.location.host)||y[e]===t||y[e]||E)return;function r(e){return`__firebase__banner__${e}`}y[e]=t;let i="__firebase__banner",n=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(y))y[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(i),t=!1,e||((e=document.createElement("div")).setAttribute("id",i),t=!0),{created:t,element:e}),a=r("text"),o=document.getElementById(a)||document.createElement("span"),c=r("learnmore"),l=document.getElementById(c)||document.createElement("a"),u=r("preprendIcon"),d=document.getElementById(u)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e=s.element;e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center",l.setAttribute("id",c),l.innerText="Learn more",l.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",l.setAttribute("target","__blank"),l.style.paddingLeft="5px",l.style.textDecoration="underline";let t=function(){let e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{E=!0;let e=document.getElementById(i);e&&e.remove()},e}();d.setAttribute("width","24"),d.setAttribute("id",u),d.setAttribute("height","24"),d.setAttribute("viewBox","0 0 24 24"),d.setAttribute("fill","none"),d.style.marginLeft="-6px",e.append(d,o,l,t),document.body.appendChild(e)}n?(o.innerText="Preview backend disconnected.",d.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(d.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,o.innerText="Preview backend running in this workspace."),o.setAttribute("id",a)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}("Auth",!0)):function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${a}`),n}(ef({apiKey:"AIzaSyBbQOpJTZmcGdszjtk_Sk2bKXaC5czmRr8",authDomain:"intrackt-908ae.firebaseapp.com",projectId:"intrackt-908ae",storageBucket:"intrackt-908ae.firebasestorage.app",messagingSenderId:"807157076800",appId:"1:807157076800:web:5a41a3959d754a7916a0a5",measurementId:"G-4L3PZXJ4C9"})),im={BACKEND_BASE_URL:"http://localhost:3000",AUTH_URL:"/api/auth/auth-url",AUTH_TOKEN:"/api/auth/token",SYNC_EMAILS:"/api/emails",FETCH_STORED_EMAILS:"/api/emails/stored-emails",FOLLOWUP_NEEDED:"/api/emails/followup-needed",SYNC_STATUS:"/api/emails/sync-status",REPORT_MISCLASSIFICATION:"/api/emails/misclassification",UNDO_MISCLASSIFICATION:"/api/emails/undo-misclassification",FETCH_USER_PLAN:"/api/user",UPDATE_USER_PLAN:"/api/user/update-plan",SEND_REPLY:"/api/emails/send-reply",ARCHIVE_EMAIL:"/api/emails/archive",APPLICATION_STATS:"/api/emails/applications/stats"},ig=new Promise(e=>{r=e}),iI=!1,iy=null;async function iE(e){return iy||(iy=e.getIdToken(!0).finally(()=>{iy=null})),iy}let i_={info:(...e)=>{try{console.log("[bg][info]",...e)}catch(e){}},error:(...e)=>{try{console.error("[bg][error]",...e)}catch(e){}}};async function iv(e,t={}){await ig;let r=ip.currentUser,i={"Content-Type":"application/json",...t.headers};if(r&&!r.isAnonymous)try{let e=await iE(r);i.Authorization=`Bearer ${e}`,i_.info(`Attached fresh ID token for user: ${r.uid}`)}catch(e){if(i_.error("Failed to get fresh Firebase ID token:",e),"auth/user-token-expired"===e.code||"auth/invalid-user-token"===e.code)throw console.warn("AppMailia AI: Unrecoverable auth token error. Forcing user logout."),await rh(ip),chrome.runtime.sendMessage({type:"FORCE_LOGOUT",reason:"Your session has expired. Please log in again."}),Error("User session expired and was forcefully terminated.")}else r&&r.isAnonymous?i_.info("Anonymous user, skipping ID token attachment."):i_.info("No authenticated user, skipping ID token attachment.");let n=`${im.BACKEND_BASE_URL}${e}`;if(t.query&&"object"==typeof t.query){let e=new URLSearchParams(t.query).toString();e&&(n+=(n.includes("?")?"&":"?")+e)}i_.info(`API call: ${n} method=${t.method||"GET"}`);try{let e=await fetch(n,{...t,headers:i,body:t.body&&"object"==typeof t.body?JSON.stringify(t.body):t.body});if(!e.ok){let t=await e.text();throw console.error(`\u{274C} AppMailia AI: API Error ${e.status} from ${n}:`,t),Error(`Backend error: ${e.status} - ${t}`)}let r=await e.json();return i_.info(`API success: ${n}`,r),r}catch(e){throw console.error(`\u{274C} AppMailia AI: Network or parsing error for ${n}:`,e),Error(`Network or server error: ${e.message}`)}}async function iw(e){try{let t=await iv(im.FETCH_STORED_EMAILS,{method:"POST",body:{limit:999}});t.success&&t.categorizedEmails&&(await chrome.storage.local.set({appliedEmails:t.categorizedEmails.applied||[],interviewedEmails:t.categorizedEmails.interviewed||[],offersEmails:t.categorizedEmails.offers||[],rejectedEmails:t.categorizedEmails.rejected||[],irrelevantEmails:t.categorizedEmails.irrelevant||[]}),chrome.runtime.sendMessage({type:"EMAILS_SYNCED",success:!0,categorizedEmails:t.categorizedEmails,syncInProgress:e}))}catch(e){console.warn("AppMailia AI Background: refreshStoredEmailsCache failed:",e?.message)}}async function ib(e=60,t=1e4){let r=Date.now();for(;Date.now()-r<1e3*e;){try{let e=await iv(im.SYNC_STATUS,{method:"GET"});if(e?.success)if(!e.sync?.inProgress)return void await iw(!1);else await iw(!0)}catch(e){console.warn("AppMailia AI Background: sync-status polling error:",e?.message)}await new Promise(e=>setTimeout(e,t))}}async function iT(){try{let e=await iv(im.SYNC_STATUS,{method:"GET"});if(!e?.success||!e?.sync?.inProgress)return;let t=e.sync.startedAt||e.sync.lockAcquiredAt||e.sync.lock?.acquiredAt||e.sync.lock?.since||e.sync.started||e.sync.started_at||e.sync.lastSyncAt,r=t?new Date(t).getTime():Date.now(),i=(Date.now()-r)/6e4;i>=15&&chrome.runtime.sendMessage({type:"SYNC_STUCK",minutesInProgress:Math.round(i),thresholdMinutes:15,sync:e.sync})}catch(e){console.warn("AppMailia AI Background: watchdog check failed:",e?.message)}}async function iA(e,t,r,i,n,s){if(!ip.currentUser)throw Error("User not authenticated for sending email.");return await iv(im.SEND_REPLY,{method:"POST",body:{threadId:e,to:t,subject:r,body:i,userEmail:n,userId:s}})}async function iS(e,t,r=!1){if(!e||!t)return console.error(" AppMailia AI Background: Cannot trigger email sync, userEmail or userId is missing."),{success:!1,error:"User email or ID missing for sync."};if(iI){let e=await chrome.storage.local.get(["appliedEmails","interviewedEmails","offersEmails","rejectedEmails","quotaData"]);return{success:!0,categorizedEmails:{applied:e.appliedEmails||[],interviewed:e.interviewedEmails||[],offers:e.offersEmails||[],rejected:e.rejectedEmails||[]},quota:e.quotaData||null,sync:{inProgress:!0}}}iI=!0,Date.now();try{let i=await iv(im.SYNC_EMAILS,{method:"POST",body:{userEmail:e,userId:t,fullRefresh:r,email:e}}),n=null;try{let e=await iv(im.APPLICATION_STATS,{method:"GET"});e.success&&e.stats&&(n=e.stats,i_.info("Application stats fetched:",n))}catch(e){i_.error("Failed to fetch application stats:",e)}if(i.success&&i.categorizedEmails){if(i.sync?.inProgress){await chrome.storage.local.set({quotaData:i.quota||null,categoryTotals:i.categoryTotals||null,applicationStats:n||null}),i_.info("Sync in progress - updated quota and category totals only, preserving existing emails in storage.");let t=await chrome.storage.local.get(["appliedEmails","interviewedEmails","offersEmails","rejectedEmails","irrelevantEmails"]);chrome.runtime.sendMessage({type:"EMAILS_SYNCED",success:!0,categorizedEmails:{applied:t.appliedEmails||[],interviewed:t.interviewedEmails||[],offers:t.offersEmails||[],rejected:t.rejectedEmails||[],irrelevant:t.irrelevantEmails||[]},categoryTotals:i.categoryTotals,applicationStats:n,quota:i.quota,userEmail:e,syncInProgress:!0})}else await chrome.storage.local.set({appliedEmails:i.categorizedEmails.applied||[],interviewedEmails:i.categorizedEmails.interviewed||[],offersEmails:i.categorizedEmails.offers||[],rejectedEmails:i.categorizedEmails.rejected||[],quotaData:i.quota||null,categoryTotals:i.categoryTotals||null,applicationStats:n||null}),i_.info("Emails and quota cached successfully in local storage."),chrome.runtime.sendMessage({type:"EMAILS_SYNCED",success:!0,categorizedEmails:i.categorizedEmails,categoryTotals:i.categoryTotals,applicationStats:n,quota:i.quota,userEmail:e,syncInProgress:!1});return i.sync?.inProgress&&ib().catch(e=>console.warn("AppMailia AI Background: polling failed:",e?.message)),{success:!0,categorizedEmails:i.categorizedEmails,quota:i.quota}}if("INSUFFICIENT_SCOPES"===i.errorCode||i.requiresReauth)return console.error(" AppMailia AI Background: Insufficient Gmail permissions - user needs to re-authenticate"),chrome.runtime.sendMessage({type:"SCOPE_ERROR",error:i.error||"Your Gmail permissions are incomplete. Please sign out and sign in again.",requiresReauth:!0}),{success:!1,error:i.error,errorCode:"INSUFFICIENT_SCOPES",requiresReauth:!0};return console.error(" AppMailia AI Background: Backend sync failed or returned no emails:",i.error),{success:!1,error:i.error||"Backend sync failed or returned no emails."}}catch(e){if(console.error(" AppMailia AI Background: Error during email sync:",e),"INSUFFICIENT_SCOPES"===e.errorCode||e.requiresReauth)return chrome.runtime.sendMessage({type:"SCOPE_ERROR",error:e.message||"Your Gmail permissions are incomplete. Please sign out and sign in again.",requiresReauth:!0}),{success:!1,error:e.message,errorCode:"INSUFFICIENT_SCOPES",requiresReauth:!0};return{success:!1,error:e.message}}finally{iI=!1}}async function ik(e,t,r){return new Promise(t=>{let r,i,n=()=>{r&&clearInterval(r),i&&clearTimeout(i),chrome.tabs.onUpdated.removeListener(s),chrome.tabs.onRemoved.removeListener(a)},s=(r,i,s)=>{r===e&&i.url&&(i_.info("Payment tab URL changed to:",i.url),i.url.includes("success")||i.url.includes("dashboard.stripe.com/success")?(i_.info("Payment completed successfully"),n(),chrome.tabs.remove(e),t({success:!0,sessionCompleted:!0,plan:"premium"})):(i.url.includes("cancel")||i.url.includes("dashboard.stripe.com/cancel"))&&(i_.info("Payment cancelled"),n(),chrome.tabs.remove(e),t({success:!0,cancelled:!0})))},a=r=>{r===e&&(i_.info("Payment tab was closed"),n(),t({success:!0,cancelled:!0}))};chrome.tabs.onUpdated.addListener(s),chrome.tabs.onRemoved.addListener(a),r=setInterval(async()=>{try{let r=await iv("/api/subscriptions/status",{method:"GET"});r?.success&&r.subscription?.status==="active"&&(i_.info("Subscription detected as active during payment flow"),n(),chrome.tabs.remove(e).catch(()=>{}),t({success:!0,sessionCompleted:!0,plan:"premium"}))}catch(e){console.warn(" AppMailia AI Background: Error checking subscription status during payment flow:",e)}},3e3),i=setTimeout(()=>{i_.info("Payment flow timed out after 10 minutes"),n(),chrome.tabs.remove(e).catch(()=>{}),t({success:!0,cancelled:!0})},6e5)})}chrome.runtime.onMessage.addListener((e,t,r)=>(i_.info(`Received message type: ${e.type}`),(async()=>{let t=await chrome.storage.local.get(["userEmail","userId"]),i=t.userId,n=t.userEmail,s=!!ip.currentUser&&!ip.currentUser.isAnonymous,a=!!n&&!!i;if(!s&&!a&&"LOGIN_GOOGLE_OAUTH"!==e.type){console.warn(`AppMailia AI Background: User not authenticated or user info not cached for message type: ${e.type}.`),r({success:!1,error:"User not authenticated or user info not available."});return}switch(e.type){case"LOGIN_GOOGLE_OAUTH":try{let e=chrome.identity.getRedirectURL(),t=await iv(im.AUTH_URL,{method:"GET",headers:{"Content-Type":"application/json"},query:{redirect_uri:e}});if(!t.success||!t.url)throw Error(t.error||"Failed to get auth URL from backend.");let i=t.url;i_.info(`Attempting to launch Web Auth Flow with URL: ${i}`);let n=await new Promise((e,t)=>{chrome.identity.launchWebAuthFlow({url:i,interactive:!0},r=>chrome.runtime.lastError?t(Error(chrome.runtime.lastError.message)):r?void e(r):t(Error("OAuth flow cancelled or failed.")))}),s=new URLSearchParams(new URL(n).search).get("code");if(!s)throw Error("Authorization code not found in redirect URL.");let a=await iv(im.AUTH_TOKEN,{method:"POST",body:{code:s,redirect_uri:e}});if(!a.success||!a.firebaseToken)throw Error(a.error||"Failed to exchange code for Firebase token.");let o=(await ru(ip,a.firebaseToken)).user;i_.info("Successfully signed in to Firebase with custom token."),await chrome.storage.local.set({userEmail:o.email,userName:a.userName||o.email,userId:o.uid,userPlan:a.userPlan||"free"}),await iS(o.email,o.uid,!0),r({success:!0,userEmail:o.email,userName:a.userName,userPlan:a.userPlan,userId:o.uid})}catch(e){console.error(" AppMailia AI Background: Error during Google OAuth login:",e),r({success:!1,error:e.message})}break;case"LOGOUT":try{await rh(ip),i_.info("User signed out from Firebase."),r({success:!0})}catch(e){console.error(" AppMailia AI Background: Error during logout:",e),r({success:!1,error:e.message})}break;case"FETCH_USER_PLAN":try{let e=await iv(im.FETCH_USER_PLAN,{method:"POST",body:{email:n,userEmail:n,userId:i}});e.success?(await chrome.storage.local.set({userPlan:e.plan}),r({success:!0,plan:e.plan})):r({success:!1,error:e.error})}catch(e){console.error(" AppMailia AI Background: Error fetching user plan:",e),r({success:!1,error:e.message})}break;case"UPDATE_USER_PLAN":try{let{newPlan:t}=e,s=await iv(im.UPDATE_USER_PLAN,{method:"POST",body:{newPlan:t,userEmail:n,email:n,userId:i}});s.success&&await chrome.storage.local.set({userPlan:t}),r(s)}catch(e){console.error(" AppMailia AI Background: Error updating user plan:",e),r({success:!1,error:e.message})}break;case"FETCH_STORED_EMAILS":console.warn("AppMailia AI Background: Received FETCH_STORED_EMAILS, but popup should read directly from local storage."),r({success:!0,message:"Handled by popup's direct storage access."});break;case"FETCH_NEW_EMAILS":try{let t=await iS(n,i,e.fullRefresh);r(t)}catch(e){console.error(" AppMailia AI Background: Error fetching new emails:",e),r({success:!1,error:e.message})}break;case"FETCH_QUOTA_DATA":try{let e=await iv(im.SYNC_EMAILS,{method:"POST",body:{userEmail:n,email:n,userId:i,fetchOnlyQuota:!0}});e.success&&e.quota?(await chrome.storage.local.set({quotaData:e.quota}),r({success:!0,quota:e.quota})):r({success:!1,error:e.error||"Quota data not found in response."})}catch(e){console.error(" AppMailia AI Background: Error fetching quota data:",e),r({success:!1,error:e.message})}break;case"FETCH_FOLLOWUP_SUGGESTIONS":try{let e=await iv(im.FOLLOWUP_NEEDED,{method:"POST",body:{userEmail:n,email:n,userId:i}});e.success&&e.suggestions?(await chrome.storage.local.set({followUpSuggestions:e.suggestions}),r({success:!0,suggestions:e.suggestions})):r({success:!1,error:e.error||"Follow-up suggestions not found."})}catch(e){console.error(" AppMailia AI Background: Error fetching follow-up suggestions:",e),r({success:!1,error:e.message})}break;case"SUGGESTION_ACTION":try{let t=await iv("/api/suggestions/action",{method:"POST",body:{threadId:e.threadId,actionType:e.actionType,userEmail:n,userId:i}});r(t)}catch(e){console.error(" AppMailia AI Background: Error marking suggestion action:",e),r({success:!1,error:e.message})}break;case"SUGGESTION_SNOOZE":try{let t=await iv("/api/suggestions/snooze",{method:"POST",body:{threadId:e.threadId,actionType:e.actionType,snoozeDuration:e.snoozeDuration,userEmail:n,userId:i}});r(t)}catch(e){console.error(" AppMailia AI Background: Error snoozing suggestion:",e),r({success:!1,error:e.message})}break;case"UNDO_SUGGESTION_ACTION":try{let t=await iv("/api/suggestions/action",{method:"DELETE",body:{threadId:e.threadId,actionType:e.actionType,userEmail:n,userId:i}});r(t)}catch(e){console.error(" AppMailia AI Background: Error undoing suggestion action:",e),r({success:!1,error:e.message})}break;case"SEND_EMAIL_REPLY":try{let{threadId:t,recipient:s,subject:a,body:o}=e,c=await iA(t,s,a,o,n,i);c.success?(await iS(n,i,!1),r({success:!0,gmailMessageId:c.gmailMessageId,threadId:c.threadId})):r({success:!1,error:c.error,needsReauth:c.needsReauth})}catch(e){console.error(" AppMailia AI Background: Error sending email reply:",e),r({success:!1,error:e.message})}break;case"ARCHIVE_EMAIL":try{let t=await iv(im.ARCHIVE_EMAIL,{method:"POST",body:{threadId:e.threadId,userEmail:n,email:n,userId:i}});t.success&&await iS(n,i,!1),r(t)}catch(e){console.error(" AppMailia AI Background: Error archiving email:",e),r({success:!1,error:e.message})}break;case"REPORT_MISCLASSIFICATION":try{let t={...e.emailData,userEmail:n,email:n,userId:i},s=await iv(im.REPORT_MISCLASSIFICATION,{method:"POST",body:t});s.success?(await iS(n,i,!1),chrome.runtime.sendMessage({type:"SHOW_NOTIFICATION",msg:"Email misclassification reported successfully!",msgType:"success"})):chrome.runtime.sendMessage({type:"SHOW_NOTIFICATION",msg:`Failed to report misclassification: ${s.error}`,msgType:"error"}),r(s)}catch(e){console.error(" AppMailia AI Background: Error reporting misclassification:",e),chrome.runtime.sendMessage({type:"SHOW_NOTIFICATION",msg:`Error reporting misclassification: ${e.message}`,msgType:"error"}),r({success:!1,error:e.message})}break;case"UNDO_MISCLASSIFICATION":try{let t={...e.undoData,userEmail:n,email:n,userId:i},s=await iv(im.UNDO_MISCLASSIFICATION,{method:"POST",body:t});s.success?(await iS(n,i,!1),chrome.runtime.sendMessage({type:"SHOW_NOTIFICATION",msg:"Misclassification undone successfully!",msgType:"success"})):chrome.runtime.sendMessage({type:"SHOW_NOTIFICATION",msg:`Failed to undo misclassification: ${s.error}`,msgType:"error"}),r(s)}catch(e){console.error(" AppMailia AI Background: Error undoing misclassification:",e),chrome.runtime.sendMessage({type:"SHOW_NOTIFICATION",msg:`Error undoing misclassification: ${e.message}`,msgType:"error"}),r({success:!1,error:e.message})}break;case"MARK_SINGLE_EMAIL_AS_READ":try{let{emailId:t}=e.payload;if(await ig,!t)throw Error("Email ID was not provided.");let i=await iv("/api/emails/mark-as-read",{method:"POST",body:{emailId:t}});r(i)}catch(t){console.error(" AppMailia AI Background: Error in MARK_SINGLE_EMAIL_AS_READ:",t);let e=t?.message||"Unknown error";e.includes("401")||e.toLowerCase().includes("unauthorized")||e.toLowerCase().includes("session expired")?r({success:!1,error:"auth-required"}):r({success:!1,error:e})}break;case"MARK_AS_READ":try{let{category:t,userId:i}=e.payload,n=ip.currentUser;if(!n||n.uid!==i)return void r({success:!1,error:"Unauthorized or user mismatch for marking as read."});try{await iv("/api/emails/mark-as-read-category",{method:"POST",body:{category:function(e){return e?e.charAt(0).toUpperCase()+e.slice(1):e}(t)}})}catch(e){console.warn("AppMailia AI Background: Backend mark-as-read-category failed, aborting local update:",e?.message),r({success:!1,error:e.message});return}let s=((await chrome.storage.local.get(["appliedEmails","interviewedEmails","offersEmails","rejectedEmails","irrelevantEmails"]))[`${t}Emails`]||[]).map(e=>({...e,is_read:!0}));await chrome.storage.local.set({[`${t}Emails`]:s}),console.log(`\u{2705} AppMailia AI Background: Marked emails in category '${t}' as read in local storage.`),r({success:!0,message:`Emails in ${t} marked as read.`})}catch(e){console.error(" AppMailia AI Background: Error marking emails as read:",e),r({success:!1,error:e.message})}break;case"UPDATE_COMPANY_NAME":try{let{emailId:t,companyName:i}=e;if(!t||!i)return void r({success:!1,error:"Missing required parameters (emailId or companyName)."});let n=await iv(`/api/emails/${t}/company`,{method:"PATCH",body:{companyName:i.trim()}});if(n.success&&n.email){let e=await chrome.storage.local.get(["appliedEmails","interviewedEmails","offersEmails","rejectedEmails","irrelevantEmails"]);for(let r of["appliedEmails","interviewedEmails","offersEmails","rejectedEmails","irrelevantEmails"]){let i=e[r]||[],s=i.findIndex(e=>e.id===t);if(-1!==s){i[s]={...i[s],company_name:n.email.company_name,company_name_corrected:n.email.company_name_corrected,extraction_method:n.email.extraction_method},await chrome.storage.local.set({[r]:i}),i_.info(`Updated company name for email ${t} in ${r}`);break}}}r(n)}catch(e){console.error(" AppMailia AI Background: Error updating company name:",e),r({success:!1,error:e.message})}break;case"GET_CORRECTION_ANALYTICS":try{let{since:t}=e,i=await iv("/api/emails/analytics/corrections",{method:"GET",query:t?{since:t}:{}});r(i)}catch(e){console.error(" AppMailia AI Background: Error fetching correction analytics:",e),r({success:!1,error:e.message})}break;case"UPDATE_POSITION":try{let{emailId:t,position:i}=e;if(!t||!i)return void r({success:!1,error:"Missing required parameters (emailId or position)."});let n=await iv(`/api/emails/${t}/position`,{method:"PATCH",body:{position:i.trim()}});if(n.success&&n.email){let e=await chrome.storage.local.get(["appliedEmails","interviewedEmails","offersEmails","rejectedEmails","irrelevantEmails"]);for(let r of["appliedEmails","interviewedEmails","offersEmails","rejectedEmails","irrelevantEmails"]){let i=e[r]||[],s=i.findIndex(e=>e.id===t);if(-1!==s){i[s]={...i[s],position:n.email.position,position_corrected:n.email.position_corrected,extraction_method:n.email.extraction_method},await chrome.storage.local.set({[r]:i}),i_.info(`Updated position for email ${t} in ${r}`);break}}}r(n)}catch(e){console.error(" AppMailia AI Background: Error updating position:",e),r({success:!1,error:e.message})}break;case"GET_CURRENT_USER":try{let e=ip.currentUser;e&&!e.isAnonymous?r({success:!0,user:{uid:e.uid,email:e.email,displayName:e.displayName}}):r({success:!1,user:null})}catch(e){console.error(" AppMailia AI Background: Error getting current user:",e),r({success:!1,error:e.message})}break;case"FETCH_APPLICATION_LIFECYCLE":try{let{applicationId:t}=e;if(!t){r({success:!1,error:"Application ID is required"});break}let i=await iv(`/api/emails/applications/${t}/lifecycle`,{method:"GET"});i.success?r({success:!0,application:i.application,lifecycle:i.lifecycle}):r({success:!1,error:i.error||"Failed to fetch lifecycle"})}catch(e){i_.error("Error fetching application lifecycle:",e),r({success:!1,error:e.message})}break;case"GET_ID_TOKEN":try{let e=ip.currentUser;if(e&&!e.isAnonymous){let t=await e.getIdToken();r({success:!0,token:t})}else r({success:!1,error:"User not authenticated"})}catch(e){console.error(" AppMailia AI Background: Error getting ID token:",e),r({success:!1,error:e.message})}break;case"PAYMENT_SUCCESS":try{console.log("\uD83D\uDD04 AppMailia AI Background: Waiting 3 seconds for webhook processing..."),await new Promise(e=>setTimeout(e,3e3));let e=await iv(im.FETCH_USER_PLAN,{method:"POST",body:{email:n,userEmail:n,userId:i}});e.success?(await chrome.storage.local.set({userPlan:e.plan}),console.log(" AppMailia AI Background: User plan refreshed after payment:",e.plan),r({success:!0,plan:e.plan})):(console.error(" AppMailia AI Background: Failed to refresh user plan after payment:",e.error),r({success:!1,error:e.error}))}catch(e){console.error(" AppMailia AI Background: Error refreshing user plan after payment:",e),r({success:!1,error:e.message})}break;case"CHECK_PAYMENT_STATUS":try{let t=await iv(im.FETCH_USER_PLAN,{method:"POST",body:{email:e.userEmail,userEmail:e.userEmail,userId:e.userId}});t.success?(console.log(" AppMailia AI Background: Payment status checked:",t.plan),r({success:!0,plan:t.plan})):(console.error(" AppMailia AI Background: Failed to check payment status:",t.error),r({success:!1,error:t.error}))}catch(e){console.error(" AppMailia AI Background: Error checking payment status:",e),r({success:!1,error:e.message})}break;case"CHECK_SUBSCRIPTION_STATUS":try{let e=await iv("/api/subscriptions/status",{method:"GET"});e.success?(console.log(" AppMailia AI Background: Subscription status checked:",e.subscription),r({success:!0,subscription:e.subscription})):(console.error(" AppMailia AI Background: Failed to check subscription status:",e.error),r({success:!1,error:e.error}))}catch(e){console.error(" AppMailia AI Background: Error checking subscription status:",e),r({success:!1,error:e.message})}break;case"CREATE_CHECKOUT_SESSION":try{let t=await iv("/api/subscriptions/create-checkout-session",{method:"POST",body:{priceId:e.priceId}});t.success?(console.log(" AppMailia AI Background: Checkout session created:",t.url),r({success:!0,url:t.url})):(console.error(" AppMailia AI Background: Failed to create checkout session:",t.error),r({success:!1,error:t.error}))}catch(e){console.error(" AppMailia AI Background: Error creating checkout session:",e),r({success:!1,error:e.message})}break;case"CREATE_SETUP_INTENT":try{let e=await iv("/api/subscriptions/create-setup-intent",{method:"POST"});e.success?(console.log(" AppMailia AI Background: Setup intent created:",e.client_secret),r({success:!0,client_secret:e.client_secret})):(console.error(" AppMailia AI Background: Failed to create setup intent:",e.error),r({success:!1,error:e.error}))}catch(e){console.error(" AppMailia AI Background: Error creating setup intent:",e),r({success:!1,error:e.message})}break;case"OPEN_CUSTOMER_PORTAL":try{let{return_url:t}=e;console.log("\uD83C\uDFAB AppMailia AI Background: Creating customer portal session");let i=await iv("/api/subscriptions/create-portal-session",{method:"POST",body:JSON.stringify({return_url:t||chrome.runtime.getURL("popup/index.html")})});if(i.success&&i.url){console.log(" AppMailia AI Background: Portal session created");let e=await chrome.tabs.create({url:i.url,active:!0});console.log("\uD83E\uDE9F AppMailia AI Background: Portal opened in tab:",e.id),r({success:!0,tabId:e.id})}else console.error(" AppMailia AI Background: Failed to create portal session:",i.error),r({success:!1,error:i.error||"Failed to create portal session"})}catch(e){console.error(" AppMailia AI Background: Error creating portal session:",e),r({success:!1,error:e.message})}break;case"OPEN_PAYMENT_WINDOW":try{let{url:t}=e;console.log("\uD83E\uDE9F AppMailia AI Background: Opening payment window:",t);let s=await chrome.tabs.create({url:t,active:!0}),a=await ik(s.id,n,i);r(a)}catch(e){console.error(" AppMailia AI Background: Error opening payment window:",e),r({success:!1,error:e.message})}break;case"OPEN_PORTAL_WINDOW":console.log(" AppMailia AI Background: Portal window opening removed - using in-extension approach"),r({success:!1,error:"Portal functionality removed for fully in-extension approach"});break;case"CANCEL_SUBSCRIPTION":try{console.log("\uD83D\uDDD1 AppMailia AI Background: Canceling subscription");let e=await iv("/api/subscriptions/cancel",{method:"POST"});e.success?(console.log(" AppMailia AI Background: Subscription canceled successfully"),r({success:!0,subscription:e.subscription})):(console.error(" AppMailia AI Background: Failed to cancel subscription:",e.error),r({success:!1,error:e.error}))}catch(e){console.error(" AppMailia AI Background: Error canceling subscription:",e),r({success:!1,error:e.message})}break;case"RESUME_SUBSCRIPTION":try{console.log("\uD83D\uDD04 AppMailia AI Background: Resuming subscription");let e=await iv("/api/subscriptions/resume",{method:"POST"});e.success?(console.log(" AppMailia AI Background: Subscription resumed successfully"),r({success:!0,subscription:e.subscription})):(console.error(" AppMailia AI Background: Failed to resume subscription:",e.error),r({success:!1,error:e.error}))}catch(e){console.error(" AppMailia AI Background: Error resuming subscription:",e),r({success:!1,error:e.message})}break;default:console.warn("AppMailia AI: Unhandled message type:",e.type),r({success:!1,error:"Unhandled message type."})}})(),!0)),R(ip).setPersistence(rM).then(()=>{console.log(" AppMailia AI Background: Firebase Auth persistence set to IndexedDB."),rd(ip,async e=>{if(r(),e)if(console.log(" AppMailia AI Background: Auth State Changed - User logged in:",e.email,"UID:",e.uid),await chrome.storage.local.set({userEmail:e.email,userName:e.displayName||e.email,userId:e.uid}),e.isAnonymous)console.log("AppMailia AI Background: Anonymous user detected. Not fetching plan or syncing emails.");else{try{let t=await iv(im.FETCH_USER_PLAN,{method:"POST",body:{email:e.email,userId:e.uid}});t.success?(await chrome.storage.local.set({userPlan:t.plan}),console.log(" AppMailia AI Background: User plan fetched and stored:",t.plan)):console.error(" AppMailia AI Background: Failed to fetch user plan during auth state change:",t.error)}catch(e){console.error(" AppMailia AI Background: Network/communication error fetching user plan during auth state change:",e)}let t=!0;try{let e=await iv(im.SYNC_STATUS,{method:"GET"}),r=e?.sync?.lastSyncAt?new Date(e.sync.lastSyncAt):null;r&&Date.now()-r.getTime()<864e5&&(t=!1)}catch(e){t=!0}await iS(e.email,e.uid,t)}else console.log(" AppMailia AI Background: Auth State Changed - User logged out."),await chrome.storage.local.remove(["userEmail","userName","userId","userPlan","appliedEmails","interviewedEmails","offersEmails","rejectedEmails","quotaData","followUpSuggestions"]);chrome.runtime.sendMessage({type:"AUTH_READY",success:!0,loggedOut:!e})})}).catch(e=>{console.error(" AppMailia AI Background: Error setting Firebase Auth persistence:",e),rd(ip,async e=>{r(),e?(console.log("AppMailia AI Background: Auth State Changed (without persistence) - User logged in:",e.email),await chrome.storage.local.set({userEmail:e.email,userName:e.displayName||e.email,userId:e.uid}),e.isAnonymous||await iS(e.email,e.uid,!1)):(console.log("AppMailia AI Background: Auth State Changed (without persistence) - User logged out."),await chrome.storage.local.remove(["userEmail","userName","userId","userPlan","appliedEmails","interviewedEmails","offersEmails","rejectedEmails","quotaData","followUpSuggestions"])),chrome.runtime.sendMessage({type:"AUTH_READY",success:!0,loggedOut:!e})})}),chrome.alarms.create("syncEmails",{periodInMinutes:15}),chrome.alarms.create("syncWatchdog",{periodInMinutes:5}),chrome.alarms.onAlarm.addListener(async e=>{if("syncEmails"===e.name){console.log(" AppMailia AI: Syncing emails via alarm...");let e=ip.currentUser;if(e&&!e.isAnonymous)try{let e=await chrome.storage.local.get(["userEmail","userId"]);e.userEmail&&e.userId?await iS(e.userEmail,e.userId,!1):console.warn("AppMailia AI: User not logged in or user info missing for alarm sync.")}catch(e){console.error(" AppMailia AI: Error during alarm-triggered email sync:",e),chrome.runtime.sendMessage({type:"EMAILS_SYNCED",success:!1,error:e.message})}else console.log("AppMailia AI: Skipping email sync for unauthenticated or anonymous user.")}else"syncWatchdog"===e.name&&await iT()})})();